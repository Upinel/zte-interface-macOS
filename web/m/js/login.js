define(["service","knockout","configPath","router","language"],function(n,o,e,t,i){function a(){var t=(n.getConnectionMode(),this);t.hasSave=o.observable(e.HAS_SAVE_LOGIN_PASSWORD),t.showLanguage=o.observable(e.LANGUAGES.length>1);var a=i.getLanguage(),r=_.map(e.LANGUAGES,function(n){return new Option(n.name,n.value)});t.languages=o.observableArray(r),t.currentLan=o.observable(a.Language),t.hasGDPR=o.observable(e.HAS_GDPR),t.langChangeHandler=function(o,e){clearValidateMsg(),n.setLanguage({Language:t.currentLan()},function(){setLocalization(t.currentLan())})},i.setLocalization(t.currentLan())}function r(){return setInterval(function(){if(!n.getStatusInfo().isLoggedIn)return void s();lastLoginStatus=n.getStatusInfo().isLoggedIn?"1":"0"},1e3)}function s(){if("#/login"!=window.location.hash)if(manualLogout||"1"!=lastLoginStatus){if("UNREAL"==lastLoginStatus)return;window.location="index.html"}else manualLogout=!1,lastLoginStatus="UNREAL",showAlert("need_login_again",function(){window.location="index.html"})}function c(){var o=i.getLanguage().Language;i.setLocalization(o),O.val(o),O.off("change").on("change",function(){var o=$(this).val();n.setLanguage({Language:o},function(){i.setLocalization(o)})})}function l(){var e=$("#container");o.cleanNode(e[0]);var t=new a;o.applyBindings(t,e[0]),h=$("#lockContainer",e),L=$("#leftUnlockTime",e),A=$("#password",e),v=$("#savePassword",e),O=$("#language"),g=0,w=0,p=0,h.hide(),c();var i=n.getStatusInfo();-1!=window.location.href.indexOf("?no_connect")?"PPPOE"==i.opms_wan_mode||("AUTO"==i.opms_wan_mode||"AUTO_BACKUP"==i.opms_wan_mode)&&"AUTO_PPPOE"==i.opms_wan_auto_mode?showAlert("pppoe_error_jump"):"modem_init_complete"==i.simStatus?"ppp_disconnected"==i.connectStatus&&("0"==i.ppp_dial_conn_fail_counter||""==i.ppp_dial_conn_fail_counter?showAlert("no_connect_jump"):showAlert("connect_failed_jump")):"modem_sim_undetected"==i.simStatus?showAlert("no_simcard_jump"):"modem_sim_destroy"==i.simStatus||"modem_destroy"==i.simStatus?showAlert("invalid_simcard_jump"):"modem_imsi_waitnck"==i.simStatus||"modem_waitpin"==i.simStatus||"modem_waitpuk"==i.simStatus?showAlert("locked_simcard_jump"):showAlert("connect_failed_jump"):-1!=window.location.href.indexOf("?flow_beyond")?showAlert("flow_beyond_jump",function(){n.setRedirectOff()}):-1!=window.location.href.indexOf("?fota_upgrade")&&showAlert("fota_upgrade_jump",function(){n.setRedirectOff()}),$("#loginBtn").off("click").on("click",function(){$("#formLogin").submit()}),$("#formLogin").validate({submitHandler:function(){d()}}),u("init")}function d(){if(""==rd0||""==rd1){var o=n.getLanguage();rd0=o.rd_params0,rd1=o.rd_params1}if(p==e.MAX_LOGIN_COUNT&&"-1"!=g)return showAlert("password_error_account_lock_time"),A.val(""),!1;window.clearInterval(k);var t={};e.HAS_SAVE_LOGIN_PASSWORD?(t.password=A.val(),t.save_login=v.is(":checked")?"1":"0"):t.password=A.val(),n.login(t,function(n){if(setTimeout(function(){k=r()},1300),n.result){e.isLogin=!0,p=0,w=300,window.clearInterval(S);var o=window.location.href;"modem_imsi_waitnck"==e.SIM_CARD_STATUS?window.location.hash="#/network_lock":-1!=window.location.href.indexOf("?no_connect")?window.location.href=o.slice(0,o.indexOf("?no_connect"))+"#/nosimcard":-1!=window.location.href.indexOf("?flow_beyond")?window.location.href=o.slice(0,o.indexOf("?flow_beyond"))+e.isTrafficAlertSet?"?traffic_view#/nosimcard":"?traffic_setting#/nosimcard":-1!=window.location.href.indexOf("?fota_upgrade")?window.location.href=o.slice(0,o.indexOf("?fota_upgrade"))+"?ota_update#/nosimcard":window.location.hash="#/nosimcard"}else A.val(""),u(function(){p==e.MAX_LOGIN_COUNT?(showAlert("password_error_five_times"),f()):showAlert({msg:"password_error_left",params:[e.MAX_LOGIN_COUNT-p]})})})}function u(o){n.getLoginData({},function(n){var t=parseInt(n.psw_fail_num_str,10);if(p=e.MAX_LOGIN_COUNT-t,g=n.login_lock_time,w=n.login_lock_time,"init"==o&&e.HAS_SAVE_LOGIN_PASSWORD){"1"==n.save_login&&(A.val(n.psw_save),v.prop("checked",!0).checkboxradio("refresh"))}$.isFunction(o)?o():p==e.MAX_LOGIN_COUNT&&f()})}function f(){S=setInterval(function(){n.getLoginData({},function(n){(n.login_lock_time<=0||3==n.psw_fail_num_str)&&(p=0,window.clearInterval(S)),g!=n.login_lock_time?(g=n.login_lock_time,w=n.login_lock_time):w=w>0?w-1:0,m()})},1e3)}function m(){if(p==e.MAX_LOGIN_COUNT&&"-1"!=g){h.show();var n=transSecond2Time(w);L.text(n.substring(n.indexOf(":")+1,n.length))}else h.hide()}var g,w,p,h,L,A,v,O,S=0,k=r();return{init:l}});
//# sourceMappingURL=../../sourcemaps/m/login.js.map
