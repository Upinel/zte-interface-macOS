define(["service","configPath","status_check","echarts","echarts/chart/pie"],function(e,t,a,i){function r(){f=i.init($("#trafficGraph")[0]),window.onresize=f.resize,s=$("#trafficSwitchOn"),n=$("#trafficSwitchOff"),d=$("#flowSwitch"),o=$("#usedInfo"),c=$("#leftInfo"),h=$("#packageInfo"),d.change(function(){var t=$(this).val();"1"==t?(s.show(),n.hide()):(s.hide(),n.show()),showLoading(),e.setTrafficAlertInfo({dataLimitChecked:t,dataLimitTypeChecked:u.dataLimitTypeChecked,wan_auto_clear_flow_data_switch:u.autoClearTraffic,traffic_clear_date:u.traffic_clear_date,limitDataMonth:u.limitDataMonth,alertDataReach:u.alertDataReach,limitTimeMonth:u.limitTimeMonth,alertTimeReach:u.alertTimeReach},function(t){"success"==t.result?(a.setTrafficAlertPopuped(!1),e.getTrafficAlertInfo({},function(e){u=e,v.updateEcharts(e),hideLoading()})):hideLoading()},function(e){hideLoading()})}),l()}function l(){var t=e.getTrafficAlertInfo();u=t;var a="0"==t.dataLimitChecked?"0":"1";d.val(a);var i=t.dataLimitTypeChecked;if("1"==a?(s.show(),n.hide()):(s.hide(),n.show()),"1"==i){var r=t.limitDataMonth.split("_"),l=r[0]||0,f=r[1]||1;o.text(transUnit(parseInt(t.monthlySent,10)+parseInt(t.monthlyReceived,10),!1));var m=parseInt(l*f*1048576,10)-(parseInt(t.monthlySent,10)+parseInt(t.monthlyReceived,10));m<0&&(m=0),c.text(transUnit(m)),h.text(transUnit(parseInt(l*f*1048576,10)))}else{var p=t.limitTimeMonth||0,y=transSecond2Time(t.monthlyConnectedTime);o.text(y);var T=3600*p-t.monthlyConnectedTime;T<0&&(T=0),c.text(transSecond2Time(T)),h.text(transSecond2Time(3600*p))}v.updateEcharts(t)}var s,n,d,o,c,h,u=null,f=null,m={title:{text:"",x:"center",y:"center",itemGap:0,textStyle:{color:"#D8D8D8",fontFamily:"微软雅黑",fontSize:20,fontWeight:"bolder"},subtextStyle:{color:"#D8D8D8",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},series:[{name:"流量控制",type:"pie",radius:["65","93"],itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},data:[],selectedOffset:3}],color:["red","red","red","red","red"]},v={cacheEle:{},getEle:function(e){return this.cacheEle.hasOwnProperty("id")?this.cacheEle[e]:(this.cacheEle[e]=$("#"+e),this.cacheEle[e])},getUnit:function(e){return"1024"==e?"GB":"1048576"==e?"TB":"MB"},data:{alarm:{value:19.7,name:"警戒区",itemStyle:{normal:{color:"#8CC916"}}},alert:{value:1,name:"提醒值",itemStyle:{normal:{color:"#FF5500"}}},free:{value:50,name:"未使用",itemStyle:{normal:{color:"#D8D8D8"}}},left1:{value:50,name:"提醒值内未使用",itemStyle:{normal:{color:"#D8D8D8"}}},used:{value:30,name:"已使用",itemStyle:{normal:{color:"#8CC916"}}},full:{value:30,name:"流量超出",itemStyle:{normal:{color:"#DF4313"}}}},updateEcharts:function(e){var t=0,a=0,i=0,r=0,l=0,s=0,n="0"==e.dataLimitChecked?"0":"1",d=e.limitDataMonth.split("_"),o=d[0]||0,c=d[1]||1,h=e.alertDataReach||0,u=e.limitTimeMonth||0,f=e.alertTimeReach||0;if("1"==n)if(m.series[0].data=[],"1"==e.dataLimitTypeChecked)if(m.title.text=o+v.getUnit(c),m.series[0].data=[],0==o){var p=v.data.used;p.value=1,p.selected=!1,m.series[0].data.push(p)}else if(t=o*c*1048576,a=parseInt(e.monthlySent,10)+parseInt(e.monthlyReceived,10),i=t*h/100,a>=t){var y=v.data.full;y.value=100,m.series[0].data.push(y)}else{i-a>0?(s=i-a,r=t-i):(l=a-i,r=t-a);var T=v.data.free;if(T.value=r,m.series[0].data.push(T),l>0){var D=v.data.alarm;D.value=l,m.series[0].data.push(D)}var S=v.data.alert;if(S.value=t/200,m.series[0].data.push(S),s>0){var w=v.data.left1;w.value=s,m.series[0].data.push(w)}var p=v.data.used;p.value=i-a>0?a:i,m.series[0].data.push(p)}else if(m.title.text=u+$.i18n.prop("hours"),m.series[0].data=[],0==u){var p=v.data.used;p.value=1,p.selected=!1,m.series[0].data.push(p)}else if(t=3600*u,a=e.monthlyConnectedTime,i=t*f/100,a>=t){var g=v.data.full;g.value=100,m.series[0].data.push(g)}else{i-a>0?(s=i-a,r=t-i):(l=a-i,r=t-a);var C=v.data.free;if(C.value=r,m.series[0].data.push(C),l>0){var I=v.data.alarm;I.value=l,m.series[0].data.push(I)}var x=v.data.alert;if(x.value=t/200,m.series[0].data.push(x),s>0){var L=v.data.left1;L.value=s,m.series[0].data.push(L)}var _=v.data.used;_.value=i-a>0?a:i,m.series[0].data.push(_)}else{var p=v.data.used;p.value=1,p.selected=!1,m.series[0].data=[p],m.title.text=""}v.setEcharts(m)},setEcharts:function(e){f.setOption(e,!0),addTimeout(function(){$(window).trigger("resize")},1e3)}};return{init:r}});
//# sourceMappingURL=../../../sourcemaps/m/traffic/view.js.map
