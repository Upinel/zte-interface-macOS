define(["jquery","knockout","config/config","service","underscore","status/statusBar","opmode/opmode"],function(e,n,t,c,a,o,i){function r(){var a=this;switch(a.isShowHomeConnect=n.observable(),c.getOpMode().opms_wan_mode){case"LTE_BRIDGE":case"PPPOE":case"DHCP":case"STATIC":a.isShowHomeConnect(!1),e("#div-station").removeClass("span9").addClass("span11");break;case"PPP":a.isShowHomeConnect(!0)}var r=c.getConnectionInfo();a.connectStatus=n.observable(r.connectStatus),checkConnectedStatus(r.connectStatus)?(a.current_Flux=n.observable(transUnit(parseInt(r.data_counter.currentReceived,10)+parseInt(r.data_counter.currentSent,10),!1)),a.connected_Time=n.observable(transSecond2Time(r.data_counter.currentConnectedTime)),a.up_Speed=n.observable(transUnit(r.data_counter.uploadRate,!0)),a.down_Speed=n.observable(transUnit(r.data_counter.downloadRate,!0))):(a.current_Flux=n.observable(transUnit(0,!1)),a.connected_Time=n.observable(transSecond2Time(0)),a.up_Speed=n.observable(transUnit(0,!0)),a.down_Speed=n.observable(transUnit(0,!0))),a.hasWifi=n.observable(t.HAS_WIFI),a.transText=n.dependentObservable(function(){return checkConnectedStatus(a.connectStatus())?"disconnect":"connect"}),a.canConnect=n.observable(d()),a.connectStatusText=n.dependentObservable(function(){return a.canConnect(),checkConnectedStatus(a.connectStatus())?e.i18n.prop("disconnect"):e.i18n.prop("connect")}),a.imagePath=n.dependentObservable(function(){return checkConnectedStatus(a.connectStatus())?"img/connect.png":"ppp_disconnected"==a.connectStatus()?"img/disconnect.png":"ppp_connecting"==a.connectStatus()?"img/connecting.gif":"img/disconnecting.gif"}),a.deviceInfo=n.observableArray([]);var u=[{headerTextTrans:"station_number",rowText:"index",width:"10%"},{headerTextTrans:"host_name",rowText:"hostName",width:"30%"},{headerTextTrans:"mac_address",rowText:"macAddress",width:"23%"},{headerTextTrans:"ip_address",rowText:"ipAddress",width:"22%"},{columnType:"button",headerTextTrans:"port_filter_action",rowText:"",width:"15%",needTrans:!0}];a.gridTemplate=new n.simpleGrid.viewModel({data:a.deviceInfo(),idName:"index",columns:u,showPager:!0,pageSize:10}),a.connectHandler=function(){checkConnectedStatus(a.connectStatus())?(showLoading("disconnecting"),c.disconnect({},function(e){e.result?(successOverlay(),i.init()):errorOverlay()})):c.getStatusInfo().roamingStatus?showConfirm("dial_roaming_connect",function(){a.connect(),i.init()}):(a.connect(),i.init())},a.connect=function(){var e=c.getStatusInfo(),n=o.getTrafficResult(e);if(e.limitVolumeEnable&&n.showConfirm){var t=null;n.usedPercent>100?(t={msg:"traffic_beyond_connect_msg"},o.setTrafficAlertPopuped(!0)):(t={msg:"traffic_limit_connect_msg",params:[n.limitPercent]},o.setTrafficAlert100Popuped(!1)),showConfirm(t,function(){s()})}else s()}}function s(){showLoading("connecting"),c.connect({},function(e){e.result?successOverlay():errorOverlay()})}function d(){var e=c.getStatusInfo();if("modem_init_complete"!=e.simStatus)return!1;if(checkConnectedStatus(e.connectStatus)){if(t.AP_STATION_SUPPORT){var n=c.getAPStationBasic();if("1"==n.ap_station_enable){if("auto_dial"==c.getConnectionMode().connectionMode)return!1}}return!0}if("0"==e.signalImg)return!1;var a=e.networkType.toLowerCase();if(""==a||"limited_service"==a||"no_service"==a)return!1;if("ppp_connecting"==e.connectStatus||"ppp_disconnecting"==e.connectStatus)return!1;if(t.AP_STATION_SUPPORT){var n=c.getAPStationBasic();if("connect"==e.connectWifiStatus&&"wifi_pref"==n.ap_station_mode)return!1}return!0}function u(e){var n=c.getConnectionInfo();e.connectStatus(n.connectStatus),checkConnectedStatus(n.connectStatus)?(e.current_Flux(transUnit(parseInt(n.data_counter.currentReceived,10)+parseInt(n.data_counter.currentSent,10),!1)),e.connected_Time(transSecond2Time(n.data_counter.currentConnectedTime)),e.up_Speed(transUnit(n.data_counter.uploadRate,!0)),e.down_Speed(transUnit(n.data_counter.downloadRate,!0))):(e.current_Flux(transUnit(0,!1)),e.connected_Time(transSecond2Time(0)),e.up_Speed(transUnit(0,!0)),e.down_Speed(transUnit(0,!0))),e.canConnect(d())}function l(n){c.getCurrentlyAttachedDevicesInfo({},function(t){var a=t.attachedDevices;if(a.length<10){var o={index:"",macAddress:" ",ipAddress:"",hostName:"",timeConnected:"",btnDisplay:!1},i=0;a?i=a.length:a=[];for(var r=10-i,s=0;s<r;s++)a.push(o)}c.getMacFilterInfo({},function(t){var c="2"==t.ACL_mode;e.each(a,function(e,o){""!=a[e].index&&(a[e].index=e+1,a[e].btnDisplay=!0,a[e].enabled=-1==t.wifi_mac_black_list.indexOf(o.macAddress)&&c,a[e].actionTrans="block",a[e].action=function(){_(t,o.macAddress,o.hostName,o.ipAddress,n)})}),n.gridTemplate.data(a)})})}function _(e,n,t,a,o){if(e.user_ip_addr==a)return showAlert("black_yourself_tip"),!1;if(e.wifi_mac_black_list.split(";").length>=32)return showAlert("black_list_max"),!1;if("1"==c.getWpsInfo().wpsFlag)return showAlert("wps_on_info"),!1;var i=""==e.wifi_hostname_black_list?t:t+";"+e.wifi_hostname_black_list,r=""==e.wifi_mac_black_list?n:n+";"+e.wifi_mac_black_list,s={ACL_mode:"2",wifi_hostname_black_list:i,wifi_mac_black_list:r};showLoading(),c.setMacFilter(s,function(e){"success"==e.result?(successOverlay(),l(o)):errorOverlay()})}function f(){var t=e("#container")[0];n.cleanNode(t);var c=new r;n.applyBindings(c,t),e("#frmHome").validate({submitHandler:function(){c.connectHandler()}}),u(c),l(c),addInterval(function(){u(c)},1e3),addInterval(function(){l(c)},3e3)}return{init:f,refreshAttachedDevicesInfo:l}});
//# sourceMappingURL=../sourcemaps/home_old.js.map
