define(["jquery","service","knockout"],function(e,n,o){function t(){function t(){r?(r=!0,window.clearInterval(l),S=0):S<29?S++:(r=!0,window.clearInterval(l),showAlert("ussd_operation_timeout"),a.USSDReply(""),a.USSDSend(""),a.USSDLocation(d.SEND),S=0)}var a=this;a.ussd_action=o.observable(i),a.USSDLocation=o.observable(d.SEND),a.USSDReply=o.observable(""),a.USSDSend=o.observable(""),a.sendToNet=function(){S=0,window.clearInterval(l);var o=a.USSDSend();if("string"!=typeof o||""==o)return void showAlert("ussd_error_input");showLoading();var s={};s.operator="ussd_send",s.strUSSDCommand=o,s.sendOrReply="send",n.getUSSDResponse(s,function(n,o){hideLoading(),n?(resetUSSD(),a.USSDLocation(d.REPLY),a.ussd_action(o.ussd_action),15==o.ussd_dcs?e("#USSD_Content").val(o.data):e("#USSD_Content").val(decodeMessage(o.data,!0)),r=!1,S=0,"0"!=o.ussd_action&&(l=addInterval(t,1e3))):showAlert(o)})},a.replyToNet=function(){S=0,window.clearInterval(l);var o=a.USSDReply();if("string"!=typeof o||""==o)return void showAlert("ussd_error_input");showLoading();var s={};s.operator="ussd_reply",s.strUSSDCommand=o,s.sendOrReply="reply",n.getUSSDResponse(s,function(n,o){hideLoading(),n?(a.ussd_action(o.ussd_action),15==o.ussd_dcs?e("#USSD_Content").val(o.data):e("#USSD_Content").val(decodeMessage(o.data,!0)),r=!1,resetUSSD(),S=0,"0"!=o.ussd_action&&(l=addInterval(t,1e3))):showAlert(o)})},a.noReplyCancel=function(){S=0,r=!0,window.clearInterval(l),n.USSDReplyCancel(function(e){e?(resetUSSD(),a.USSDLocation(d.SEND)):showAlert("ussd_fail")})},cancelUSSD=function(){n.USSDReplyCancel(function(e){})},resetUSSD=function(){a.USSDReply(""),a.USSDSend("")},s&&(cancelUSSD(),s=!1)}function a(){var n=e("#container")[0];o.cleanNode(n);var a=new t;o.applyBindings(a,n)}var s=!0,S=0,r=!1,d={SEND:0,REPLY:1},i=1,l=0;return{init:a}});
//# sourceMappingURL=../../sourcemaps/ussd/ussd.js.map
