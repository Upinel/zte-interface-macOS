define(["jquery","knockout","config/config","service","underscore"],function(e,t,r,o,a){function s(){function e(){r.sourcePort(""),r.destIpAddress(""),r.destPort(""),r.selectedMode("TCP&UDP"),r.comment("")}var r=this,s=n();r.portMapEnable=t.observable(s.portMapEnable),r.oriPortMapEnable=t.observable(s.portMapEnable),r.sourcePort=t.observable(""),r.destIpAddress=t.observable(""),r.destPort=t.observable(""),r.modes=t.observableArray(l),r.selectedMode=t.observable("TCP&UDP"),r.comment=t.observable(""),r.rules=t.observableArray(s.portMapRules),r.gridTemplate=new t.simpleGrid.viewModel({data:r.rules(),idName:"index",columns:c,tmplType:"list",pageSize:s.portmap_rule_num}),r.callback=function(t){"success"==t.result?(e(),d(r),successOverlay()):errorOverlay()},r.enablePortMap=function(){showLoading();var e={};e.portMapEnable=r.portMapEnable(),o.enablePortMap(e,r.callback)},r.save=function(){if(r.rules().length>=s.portmap_rule_num)return void showAlert({msg:"rules_max",params:s.portmap_rule_num});if(r.checkExist())return void showAlert("rule_exist");showLoading();var e={};e.portMapEnable=r.portMapEnable(),e.sourcePort=r.sourcePort(),e.destIpAddress=r.destIpAddress(),e.destPort=r.destPort(),e.protocol=r.selectedMode(),e.comment=r.comment(),o.setPortMap(e,r.callback)},r.checkExist=function(){for(var e,t={sourcePort:r.sourcePort(),destIpAddress:r.destIpAddress(),destPort:r.destPort(),protocol:transProtocolValue(r.selectedMode()),comment:r.comment()},o=r.rules(),s=0;s<o.length;s++)if(e={sourcePort:o[s].sourcePort,destIpAddress:o[s].destIpAddress,destPort:o[s].destPort,protocol:o[s].protocol,comment:o[s].comment},a.isEqual(t,e))return!0;return!1},r.deleteMapRules=function(){var e=r.gridTemplate.selectedIds();if(0==e.length)return void showAlert("no_data_selected");showConfirm("confirm_data_delete",function(){showLoading();var t={};t.indexs=e,o.deleteMapRules(t,r.callback)})}}function n(){return o.getPortMap()}function d(r){var o;if(r){o=r;var a=n();return o.portMapEnable(a.portMapEnable),o.oriPortMapEnable(a.portMapEnable),o.rules(a.portMapRules),o.gridTemplate.clearAllChecked(),o.gridTemplate.data(a.portMapRules),refreshTableHeight(),void renderCheckbox()}o=new s;var d=e("#container");t.cleanNode(d[0]),t.applyBindings(o,d[0]),fixTableHeight(),e("#mapBasicForm").validate({submitHandler:function(){o.enablePortMap()}}),e("#portMapListForm").validate({submitHandler:function(){o.deleteMapRules()}}),e("#portMapForm").validate({submitHandler:function(){o.save()},rules:{txtDestIpAddress:{ip_check:!0},txtSourcePort:{digits:!0,range_except:[1,65e3]},txtDestPort:{digits:!0,range_except:[1,65e3]},txtComment:{comment_check:!0}},errorPlacement:function(e,t){"txtDestIpAddress"==t.attr("name")?e.appendTo("#txtDestIpAddressErrorDiv"):"txtSourcePort"==t.attr("name")?e.appendTo("#txtSourcePortErrorDiv"):"txtDestPort"==t.attr("name")?e.appendTo("#txtDestPortErrorDiv"):e.insertAfter(t)}})}var l=a.map(r.MAP_PROTOCOL_MODES,function(e){return new Option(e.name,e.value)}),c=[{columnType:"checkbox",rowText:"index",width:"8%"},{headerTextTrans:"source_port",rowText:"sourcePort",width:"20%"},{headerTextTrans:"dest_ip_address",rowText:"destIpAddress",width:"20%"},{headerTextTrans:"dest_port",rowText:"destPort",width:"20%"},{headerTextTrans:"protocol",rowText:"protocol",width:"12%"},{headerTextTrans:"comment",rowText:"comment",width:"20%"}];return{init:d}});
//# sourceMappingURL=../../sourcemaps/firewall/port_map.js.map
