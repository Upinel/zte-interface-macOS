define(["jquery","knockout","config/config","service","underscore"],function(r,e,t,o,a){function n(){function r(){t.ipAddress(""),t.portStart(""),t.portEnd(""),t.selectedMode("TCP&UDP"),t.comment("")}var t=this,n=d();t.portForwardEnable=e.observable(n.portForwardEnable),t.oriPortForwardEnable=e.observable(n.portForwardEnable),t.ipAddress=e.observable(""),t.portStart=e.observable(""),t.portEnd=e.observable(""),t.modes=e.observableArray(i),t.selectedMode=e.observable("3"),t.comment=e.observable(""),t.rules=e.observableArray(n.portForwardRules),t.gridTemplate=new e.simpleGrid.viewModel({data:t.rules(),idName:"index",columns:s,tmplType:"list",pageSize:n.portforward_rule_num}),t.callback=function(e){"success"==e.result?(r(),l(t),successOverlay()):errorOverlay()},t.enableVirtualServer=function(){showLoading();var r={};r.portForwardEnable=t.portForwardEnable(),o.enableVirtualServer(r,t.callback)},t.save=function(){if(t.rules().length>=n.portforward_rule_num)return void showAlert({msg:"rules_max",params:n.portforward_rule_num});if(t.checkExist())return void showAlert("rule_exist");showLoading();var r={};r.ipAddress=t.ipAddress(),r.portStart=t.portStart(),r.portEnd=t.portEnd(),r.protocol=t.selectedMode(),r.comment=t.comment(),o.setPortForward(r,t.callback)},t.checkExist=function(){for(var r,e={ipAddress:t.ipAddress(),portRange:t.portStart()+" - "+t.portEnd(),protocol:transProtocolValue(t.selectedMode()),comment:t.comment()},o=t.rules(),n=0;n<o.length;n++)if(r={ipAddress:o[n].ipAddress,portRange:o[n].portRange,protocol:o[n].protocol,comment:o[n].comment},a.isEqual(e,r))return!0;return!1},t.deleteForwardRules=function(){var r=t.gridTemplate.selectedIds();if(0==r.length)return void showAlert("no_data_selected");showConfirm("confirm_data_delete",function(){showLoading("deleting");var e={};e.indexs=r,o.deleteForwardRules(e,t.callback)})}}function d(){return o.getPortForward()}function l(t){var o;if(t){o=t;var a=d();return o.portForwardEnable(a.portForwardEnable),o.oriPortForwardEnable(a.portForwardEnable),o.rules(a.portForwardRules),o.gridTemplate.clearAllChecked(),o.gridTemplate.data(a.portForwardRules),void refreshTableHeight()}o=new n;var l=r("#container");e.cleanNode(l[0]),e.applyBindings(o,l[0]),fixTableHeight(),renderCheckbox(),r("#virtualServerForm").validate({submitHandler:function(){o.enableVirtualServer()}}),r("#portForwardListForm").validate({submitHandler:function(){o.deleteForwardRules()}}),r("#portForwardForm").validate({submitHandler:function(){o.save()},rules:{txtIpAddress:{ip_check:!0},txtPortStart:{digits:!0,range:[1,65535],portCompare:"#txtPortEnd"},txtPortEnd:{digits:!0,range:[1,65535],portCompare:"#txtPortStart"},txtComment:{comment_check:!0}},groups:{range:"txtPortStart txtPortEnd"},errorPlacement:function(r,e){"txtIpAddress"==e.attr("name")?r.appendTo("#ipErrorDiv"):"txtPortStart"==e.attr("name")||"txtPortEnd"==e.attr("name")?r.appendTo("#portRangeErrorDiv"):r.insertAfter(e)}})}var i=a.map(t.FORWARD_PROTOCOL_MODES,function(r){return new Option(r.name,r.value)}),s=[{columnType:"checkbox",rowText:"index",width:"8%"},{headerTextTrans:"ip_address",rowText:"ipAddress",width:"23%"},{headerTextTrans:"port_range",rowText:"portRange",width:"23%"},{headerTextTrans:"protocol",rowText:"protocol",width:"23%"},{headerTextTrans:"comment",rowText:"comment",width:"23%"}];return{init:l}});
//# sourceMappingURL=../../sourcemaps/firewall/port_forward.js.map
