define(["underscore","jquery","knockout","config/config","service","config/menu"],function(e,t,n,o,i,s){function c(){l=this,l.isDetecting=n.observable(!1),l.detectingContext=n.observable(""),l.detectRecords=n.observableArray([]),l.detectPosition=function(){return-1!=i.getStatusInfo().networkType.toLowerCase().indexOf("limited_service")?(showAlert("suggested_position_limited_service"),!1):g>=10?(showAlert("suggested_position_detect_popup_max_records"),!1):void i.setSuggestedPositionDetect({},function(e){"success"==e.result?(l.isDetecting(!0),l.detectingContext(""),u=window.setInterval(function(){l.getDetectProgress()},1e3)):errorOverlay()})},l.cancelPosition=function(){i.setSuggestedPositionCancel({},function(e){"success"==e.result?(successOverlay(),l.isDetecting(!1),window.clearInterval(u)):errorOverlay()})},l.getDetectProgress=function(){i.getSuggestedPositionDetectProgress({},function(e){"4"!=e.signal_detect_progress?(l.isDetecting(!0),"0"==e.signal_detect_progress?l.detectingContext(t.i18n.prop("suggested_position_detect_cancel_note","0")):"1"==e.signal_detect_progress?l.detectingContext(t.i18n.prop("suggested_position_detect_cancel_note","25")):"2"==e.signal_detect_progress?l.detectingContext(t.i18n.prop("suggested_position_detect_cancel_note","50")):"3"==e.signal_detect_progress&&l.detectingContext(t.i18n.prop("suggested_position_detect_cancel_note","75"))):(l.detectingContext(t.i18n.prop("suggested_position_detect_cancel_note","100")),setTimeout(function(){window.clearInterval(u),l.isDetecting(!1),l.detectingContext(""),r()},500))})},l.handleDetectRecords=function(){i.getSuggestedPositionDetectRecord({},function(e){g=0;for(var n in e)void 0!==e[n]&&""!=e[n]&&g++;l.detectRecords([]);var o=[];t.each(e,function(e,t){var n={index:0,date:"",location:"",quality:""};if(void 0!=t&&""!=t){var i=t.split("($)"),s=new Date(parseInt(i[0]));n.index=e.slice(-1),n.oriDate=i[0],n.date=s.toLocaleDateString(),n.location=i[1],n.quality=i[2],n.qualityTrans="suggested_position_detect_popup_"+i[2],n.qualityColor="qualityColor-"+i[2],o.push(n)}}),l.detectRecords(o),t("#detectRecords_div").translate()})},l.handleDetectRecords(),l.editLocationHandler=function(e){return t("#location_input_"+e.index).val(e.location),_.dealElement(!0,e.index),!1},l.saveLocationHandler=function(e){var n=t("#location_input_"+e.index),o=n.val();if(""==o){t(".promptErrorLabel","#confirm-message-container").text(t.i18n.prop("required"));var s=n.closest("td").addClass("has-error");return addTimeout(function(){s.removeClass("has-error")},5e3),showAlert("required"),!1}if(0==o.indexOf(" ")||o.lastIndexOf(" ")==o.length-1||/[\+;"\\]{1,32}/.test(o))return showAlert("device_rename"),!1;if(-1!=o.indexOf("($)"))return showAlert("suggested_position_detect_position_invalid"),!1;showLoading();var c={index:e.index,date:e.oriDate,location:o,quality:e.quality};i.addSuggestedPositionRecord(c,function(e){"success"==e.result?(successOverlay(),l.handleDetectRecords()):errorOverlay()})},l.cancelEditLocationHandler=function(e){_.dealElement(!1,e.index)},l.deleteSingleRecordHandler=function(e){showLoading();var t={index:e.index};i.deleteSingleSuggestedPositionRecord(t,function(e){"success"==e.result?(successOverlay(),l.handleDetectRecords()):errorOverlay()})}}function r(){showSettingWindow("suggested_position_detect_popup_title","sugPosition/suggested_popup","sugPosition/suggested_popup",400,300,function(){},"15%")}function d(){l.handleDetectRecords()}function a(){var e=t("#container")[0];n.cleanNode(e);var o=new c;n.applyBindings(o,e),t("#detectPositionForm").validate({submitHandler:function(){o.detectPosition()}}),t("#detectCancelPositionForm").validate({submitHandler:function(){o.cancelPosition()}})}var l,u=null,g=0,_={dealElement:function(e,n){e?(t("#edit_btn_"+n+",#location_txt_"+n).hide(),t("#save_btn_"+n+",#cancel_btn_"+n+",#location_input_"+n).show()):(t("#edit_btn_"+n+",#location_txt_"+n).show(),t("#save_btn_"+n+",#cancel_btn_"+n+",#location_input_"+n).hide())}};return{init:a,updateRecords:d}});
//# sourceMappingURL=../../sourcemaps/sugPosition/suggested_position.js.map
