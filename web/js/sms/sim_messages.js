define(["jquery","knockout","config/config","service"],function(e,i,n,s){function t(){return s.getSMSMessages({page:0,smsCount:f,nMessageStoreType:0,tags:10,orderBy:"order by id desc"},function(i){tryToDisableCheckAll(e("#simMsgList-checkAll"),i.messages.length),o(i.messages)},function(e){o([])})}function o(i){e.each(i,function(e,i){i.itemId=getLast8Number(i.number);for(var s=0;s<n.phonebook.length;s++){var t=n.phonebook[s];if(i.itemId==getLast8Number(t.pbm_number)){i.name=t.pbm_name;break}}}),a(i)}function a(i){null==h&&(h=e.template("simMsgListTmpl",e("#simMsgListTmpl"))),e("#simMsgList_container").html(e.tmpl("simMsgListTmpl",{data:i})),hideLoading()}function c(i){s.getPhoneBooks({page:0,data_per_page:2e3,orderBy:"name",isAsc:!0},function(s){e.isArray(s.pbm_data)&&s.pbm_data.length>0?n.phonebook=s.pbm_data:n.phonebook=[],i()},function(){errorOverlay()})}function l(){g()}function m(){0==r()?disableBtn(e("#simMsgList-delete")):enableBtn(e("#simMsgList-delete"))}function r(){return e("input:checkbox:checked","#simMsgList_container").length}function g(){showLoading();var e=function(){s.getSMSReady({},function(s){"2"==s.sms_cmd_status_result?(hideLoading(),showAlert("sms_init_fail")):"1"==s.sms_cmd_status_result?addTimeout(function(){e()},1e3):n.HAS_PHONEBOOK?i():o(n.HAS_PHONEBOOK)})},i=function(){s.getPhoneBookReady({},function(e){"6"==e.pbm_init_flag?o(!1):"0"!=e.pbm_init_flag?addTimeout(function(){i()},1e3):o(n.HAS_PHONEBOOK)})},o=function(e){e?c(function(){t()}):(n.phonebook=[],t())};e()}function u(){e(".smslist-item-msg","#simMsgTableContainer").die().live("click",function(){var i=e(this).addClass("showFullHeight");e(".smslist-item-msg.showFullHeight","#simMsgTableContainer").not(i).removeClass("showFullHeight")}),e("#simMsgList_container p.checkbox, #simMsgListForm #simMsgList-checkAll").die().live("click",function(){m()})}function d(){var n=e("#container");i.cleanNode(n[0]);var s=new l;i.applyBindings(s,n[0]),u()}var h=null,f=200;return deleteSelectedSimMsgClickHandler=function(){for(var i=e("input[name=msgId]:checked","#simMsgList_container"),n=[],t=0;t<i.length;t++)n.push(e(i[t]).val());if(0==n.length)return!1;showConfirm("confirm_sms_delete",function(){showLoading("deleting"),s.deleteMessage({ids:n},function(n){removeChecked("simMsgList-checkAll"),disableBtn(e("#simMsgList-delete"));var s="";i.each(function(i,n){s+=".simMsgList-item-class-"+e(n).val()+","}),s.length>0&&e(s.substring(0,s.length-1)).hide().remove(),tryToDisableCheckAll(e("#simMsgList-checkAll"),e(".smslist-item","#simMsgList_container").length),successOverlay()},function(e){errorOverlay(e.errorText)})})},window.smsUtil={changeLocationHandler:function(i){"sim"==e(i).val()?window.location.hash="#sim_messages":window.location.hash="#sms"}},{init:d}});
//# sourceMappingURL=../../sourcemaps/sms/sim_messages.js.map
