var globalTime="";define(["jquery","knockout","config/config","service","underscore"],function(e,t,r,n,s){function a(e,t,r){for(var n={},s=e;s<=t;s++)n.name=s,n.value=s,r.push(new Option(n.name,n.value))}function o(){function o(){_=[],-1!=e.inArray(parseInt(y.currentMonth(),10),h)?a(1,31,_):-1!=e.inArray(parseInt(y.currentMonth(),10),C)?a(1,30,_):parseInt(y.currentYear(),10)%4==0?a(1,29,_):a(1,28,_)}function i(){y.isOther0("Other"==y.currentServer0()),y.isOther1("Other"==y.currentServer1()),y.isOther2("Other"==y.currentServer2())}function f(){return"manual"==y.currentMode()?(y.isManualSetTime(!0),y.isAutoSntpTime(!1)):(y.isManualSetTime(!1),y.isAutoSntpTime(!0)),!0}n.setSNTPDate({goformId:"SNTP_Getdatastatic"});var y=this,D=n.getSntpParams();globalTime=new Date(parseInt(D.sntp_year,10),parseInt(D.sntp_month,10)-1,parseInt(D.sntp_day,10),parseInt(D.sntp_hour,10),parseInt(D.sntp_minute,10),parseInt(D.sntp_second,10)),globalTime.setTime(globalTime.getTime()-60*globalTime.getTimezoneOffset()*1e3),y.day=t.observable(),y.localTime=t.observable(),y.updateCurrentTime,y.timeSetModes=t.observableArray(u),y.isManualSetTime=t.observable(!1),y.isAutoSntpTime=t.observable(!1),y.haveDst=t.observable(!1),y.getHaveDst=t.observable(!0),y.currentMode=t.observable(D.sntp_time_set_mode),f(),y.changeSetTimeMode=function(){f()},y.currentYear=t.observable(parseInt(D.sntp_year,10)),y.currentMonth=t.observable(parseInt(D.sntp_month,10)),y.currentDate=t.observable(parseInt(D.sntp_day,10)),y.currentHour=t.observable(parseInt(D.sntp_hour,10)),y.currentMinute=t.observable(parseInt(D.sntp_minute,10)),y.years=t.observableArray(c),y.months=t.observableArray(m),y.dstStartSequences=t.observable(v),y.dstStartWeeks=t.observable(b),y.dstStartMonths=t.observable(p),y.dstStartHours=t.observable(g),y.dstStartMinutes=t.observable(T),y.dstStartSecond=t.observable(S),y.initDateList=function(){o(),y.dates(_)},o(),y.dates=t.observableArray(_),y.hours=t.observableArray(g),y.minutes=t.observableArray(T);var M=s.map(D.sntp_servers,function(e){return new Option(e.name,e.value)});y.serverList=t.observableArray(M),y.currentServer0=t.observable(D.sntp_server0),y.currentServer1=t.observable(D.sntp_server1),y.currentServer2=t.observable(D.sntp_server2),y.customServer0=t.observable(D.sntp_other_server0),y.customServer1=t.observable(D.sntp_other_server1),y.customServer2=t.observable(D.sntp_other_server2),y.isOther0=t.observable(!1),y.isOther1=t.observable(!1),y.isOther2=t.observable(!1),y.dstStartCurrentSequence=t.observable(),y.dstStartCurrentWeek=t.observable(),y.dstStartCurrentMonth=t.observable(),y.dstStartCurrentHour=t.observable(),y.dstStartCurrentMinute=t.observable(),y.dstStartCurrentSecond=t.observable(),y.dstEndCurrentSequence=t.observable(),y.dstEndCurrentWeek=t.observable(),y.dstEndCurrentMonth=t.observable(),y.dstEndCurrentHour=t.observable(),y.dstEndCurrentMinute=t.observable(),y.dstEndCurrentSecond=t.observable(),y.dstOffsetCurrentHour=t.observable(),y.dstOffsetCurrentMinute=t.observable(),y.dstOffsetCurrentSecond=t.observable(),i(),y.changeServerSelect=function(){i()},y.timeZones=t.observableArray(l),y.currentTimeZone=t.observable(D.sntp_timezone),y.daylightSaves=t.observableArray(d),y.currentDaylightSave=t.observable(D.sntp_dst_enable),"0"==D.sntp_dst_enable?y.haveDst(!1):y.haveDst(!0);var I={goformId:"GET_SNTP_INFO",timezone:D.sntp_timezone};y.callback=function(e){if(e){""==e.sntp_dst_bias&&""==e.sntp_dst_end&&""==e.sntp_dst_start?(y.haveDst(!1),y.getHaveDst(!1)):(y.getHaveDst(!0),0!=y.currentDaylightSave()&&y.haveDst(!0));var t=e.sntp_dst_bias.split("_"),r=e.sntp_dst_end.split("_"),n=e.sntp_dst_start.split("_");y.dstStartCurrentSequence(n[0]),y.dstStartCurrentWeek(n[1]),y.dstStartCurrentMonth(n[2]),y.dstStartCurrentHour(parseInt(n[3],10)),y.dstStartCurrentMinute(parseInt(n[4],10)),y.dstStartCurrentSecond(parseInt(n[5],10)),y.dstEndCurrentSequence(r[0]),y.dstEndCurrentWeek(r[1]),y.dstEndCurrentMonth(r[2]),y.dstEndCurrentHour(parseInt(r[3],10)),y.dstEndCurrentMinute(parseInt(r[4],10)),y.dstEndCurrentSecond(parseInt(r[5],10)),y.dstOffsetCurrentHour(parseInt(t[0],10)),y.dstOffsetCurrentMinute(parseInt(t[1],10)),y.dstOffsetCurrentSecond(parseInt(t[2],10))}},n.getSntpDSTByTimeZone(I,y.callback),y.dstEnableChangeHandler=function(){"0"==y.currentDaylightSave()?y.haveDst(!1):y.haveDst(!0)},y.timeZoneChangeHandler=function(){var e={goformId:"GET_SNTP_INFO",timezone:y.currentTimeZone()};n.getSntpDSTByTimeZone(e,y.callback)},y.updateCurrentTime=function(){switch(globalTime.getUTCDay()){case 0:y.day(e.i18n.prop("sunday"));break;case 1:y.day(e.i18n.prop("monday"));break;case 2:y.day(e.i18n.prop("tuesday"));break;case 3:y.day(e.i18n.prop("wednesday"));break;case 4:y.day(e.i18n.prop("thursday"));break;case 5:y.day(e.i18n.prop("friday"));break;case 6:y.day(e.i18n.prop("saturday"))}var t="",n="";if(t="1"==r.DATE_FORMAT?getTwoDigit(globalTime.getUTCDate())+"/"+getTwoDigit(globalTime.getUTCMonth()+1)+"/"+globalTime.getUTCFullYear()+" ":"2"==r.DATE_FORMAT?getTwoDigit(globalTime.getUTCMonth()+1)+"/"+getTwoDigit(globalTime.getUTCDate())+"/"+globalTime.getUTCFullYear()+" ":globalTime.getUTCFullYear()+"/"+getTwoDigit(globalTime.getUTCMonth()+1)+"/"+getTwoDigit(globalTime.getUTCDate())+" ","12"==r.TIME_FORMAT){var s=globalTime.getUTCHours()%24,a="AM";globalTime.getUTCHours()%24>12&&(a="PM",s-=12),n=getTwoDigit(s)+":"+getTwoDigit(globalTime.getUTCMinutes())+":"+getTwoDigit(globalTime.getUTCSeconds())+" "+a}else n=getTwoDigit(globalTime.getUTCHours()%24==0?0:globalTime.getUTCHours()%24)+":"+getTwoDigit(globalTime.getUTCMinutes())+":"+getTwoDigit(globalTime.getUTCSeconds());y.localTime(t+n),globalTime.setTime(globalTime.getTime()+1e3)},y.apply=function(){for(var e=[],t=0;t<D.sntp_servers.length;t++)e.push(D.sntp_servers[t].value);if(!checkConnectedStatus(D.ppp_status)&&"auto"==y.currentMode()&&"PPP"==D.opms_wan_mode)return void showAlert("sntp_syn_time_wan_connected");if(""==y.currentServer0()&&""==y.currentServer1()&&""==y.currentServer2())return void showAlert("sntp_server_error_alert");var r={goformId:"SNTP",manualsettime:y.currentMode(),sntp_server1_ip:y.currentServer0(),sntp_server2_ip:y.currentServer1(),sntp_server3_ip:y.currentServer2(),sntp_other_server0:y.customServer0(),sntp_other_server1:y.customServer1(),sntp_other_server2:y.customServer2(),timezone:y.currentTimeZone(),DaylightEnabled:y.haveDst()?y.currentDaylightSave():"0",time_year:y.currentYear(),time_month:y.currentMonth(),time_day:y.currentDate(),time_hour:y.currentHour(),time_minute:y.currentMinute(),sntp_dst_bias:y.haveDst()||y.getHaveDst()?y.dstOffsetCurrentHour()+"_"+y.dstOffsetCurrentMinute()+"_"+y.dstOffsetCurrentSecond():"",sntp_dst_end:y.haveDst()||y.getHaveDst()?y.dstEndCurrentSequence()+"_"+y.dstEndCurrentWeek()+"_"+y.dstEndCurrentMonth()+"_"+y.dstEndCurrentHour()+"_"+y.dstEndCurrentMinute()+"_"+y.dstEndCurrentSecond():"",sntp_dst_start:y.haveDst()||y.getHaveDst()?y.dstStartCurrentSequence()+"_"+y.dstStartCurrentWeek()+"_"+y.dstStartCurrentMonth()+"_"+y.dstStartCurrentHour()+"_"+y.dstStartCurrentMinute()+"_"+y.dstStartCurrentSecond():""};showLoading(""),n.setSntpSetting(r,function(e){e?n.setSNTPDate({goformId:"SNTP_Getdatastatic"},function(e){var t=n.getSntpParams();globalTime=new Date(parseInt(t.sntp_year,10),parseInt(t.sntp_month,10)-1,parseInt(t.sntp_day,10),parseInt(t.sntp_hour,10),parseInt(t.sntp_minute,10),parseInt(t.sntp_second,10)),globalTime.setTime(globalTime.getTime()-60*globalTime.getTimezoneOffset()*1e3),successOverlay()}):errorOverlay()})}}function i(){var r=e("#container");t.cleanNode(r[0]);var n=new o;t.applyBindings(n,r[0]),n.updateCurrentTime(),addInterval(function(){n.updateCurrentTime()},1e3),e("#sntpForm").validate({submitHandler:function(){n.apply()},rules:{sntp_other_server0:"sntp_invalid_server_name",sntp_other_server1:"sntp_invalid_server_name",sntp_other_server2:"sntp_invalid_server_name"}}),e("#time_zone_select option").each(function(e,t){t.title=t.text})}var u=s.map(r.sntpTimeSetMode,function(e){return new Option(e.name,e.value)}),l=s.map(r.timeZone,function(e){return new Option(e.name,e.value)}),d=s.map(r.daylightSave,function(e){return new Option(e.name,e.value)}),v=s.map(r.dstSequences,function(e){return new Option(e.name,e.value)}),b=s.map(r.dstWeeks,function(e){return new Option(e.name,e.value)}),p=s.map(r.dstMonths,function(e){return new Option(e.name,e.value)}),c=[],m=[],_=[],g=[],T=[],S=[],h=[1,3,5,7,8,10,12],C=[4,6,9,11];return a(2e3,2030,c),a(1,12,m),a(0,23,g),a(0,59,T),a(0,59,S),{init:i}});
//# sourceMappingURL=../../sourcemaps/adm/sntp.js.map
