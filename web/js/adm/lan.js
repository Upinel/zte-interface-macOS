define(["jquery","knockout","config/config","service"],function(t,e,n,s){function r(){var r=this,a=s.getStaticIpAddrList();r.isCPE=-1!=n.DEVICE.toLowerCase().indexOf("cpe");var u=i();r.wanMode=n.opms_wan_mode,r.ipAddress=e.observable(u.ipAddress),r.subnetMask=e.observable(u.subnetMask),r.macAddress=e.observable(u.macAddress),r.dhcpServer=e.observable(u.dhcpServer),r.dhcpStart=e.observable(u.dhcpStart),r.dhcpEnd=e.observable(u.dhcpEnd),r.dhcpLease=e.observable(u.dhcpLease),r.showMacAddress=e.observable(n.SHOW_MAC_ADDRESS),r.hasWifi=e.observable(n.HAS_WIFI),r.mtuValue=e.observable(u.mtuValue),r.mssValue=e.observable(u.mssValue);var o=s.getNatSetting();r.natSetting=e.observable(o.nat_mode),r.saveNat=function(){showLoading();var t={};t.natSetting=r.natSetting(),s.setNatSetting(t,function(t){"success"==t.result?successOverlay():errorOverlay()})},g=r.ipAddress()+r.subnetMask()+r.dhcpStart()+r.dhcpEnd()+r.dhcpLease(),v=r.dhcpServer(),r.refreshStatus=function(){"ppp_disconnected"==s.getConnectionInfo().connectStatus?t("input","#frmLan").each(function(){t(this).attr("disabled",!1)}):(t("input","#frmLan").each(function(){t(this).attr("disabled",!0)}),clearValidateMsg("#frmLan"))},r.clear=function(){clearTimer(),d(),clearValidateMsg()},r.save=function(){var t=r.ipAddress()+r.subnetMask()+r.dhcpStart()+r.dhcpEnd()+r.dhcpLease(),e=r.dhcpServer();if(b=t!=g||e!=v,c(r.ipAddress(),r.subnetMask(),u.ipAddress,u.subnetMask))showConfirm("dhcp_bindIP_clear_tips",function(){r.saveAct(1)});else{if(-1!=_.indexOf(a.bindStaticIPInfo,r.ipAddress()))return showAlert("dhcp_bindIP_subnet_check"),!1;b?showConfirm("lan_confirm_reopen",function(){r.saveAct(0)}):showConfirm("lan_change_none",function(){r.saveAct(0)})}},r.saveAct=function(t){showLoading();var e={ipAddress:r.ipAddress(),subnetMask:r.subnetMask(),dhcpServer:r.dhcpServer(),dhcpStart:r.dhcpStart(),dhcpEnd:r.dhcpEnd(),dhcpLease:r.dhcpLease(),mac_ip_reset:1==t?"1":"0"};s.setLanInfo(e,function(t){"success"==t.result?(successOverlay(),r.clear()):errorOverlay()})},r.saveMtu=function(){showLoading();var t={mtuValue:r.mtuValue(),mssValue:r.mssValue()};s.setMtuMss(t,function(t){"success"==t.result?(successOverlay(),r.clear()):errorOverlay()})},r.refreshStatus(),r.dhcpServerHandler=function(){return t("#txtIpAddress").parent().find(".error").hide(),t("#txtIpAddress").show(),!0}}function i(){return s.getLanInfo()}function a(e){var n=e;t("#frmLan input:text").die().live("change",function(){var t=n.ipAddress()+n.subnetMask()+n.dhcpStart()+n.dhcpEnd()+n.dhcpLease();b=t!=g}),t("#frmLan input:radio").die().live("click",function(){var t=n.dhcpServer();b=t!=v})}function d(){var n=t("#container");e.cleanNode(n[0]);var s=new r;e.applyBindings(s,n[0]),a(s),addInterval(s.refreshStatus,1e3),t("#frmLan").validate({submitHandler:function(){s.save()},rules:{txtIpAddress:{lanip_check:!0,ipRange:!0,ip_broadcast_check:!0},txtSubnetMask:{ipv4:!0,subnetmask_check:!0},txtDhcpIpPoolStart:{lanip_check:!0,dhcp_check:"start",dhcpCompare:"#txtDhcpIpPoolEnd"},txtDhcpIpPoolEnd:{lanip_check:!0,dhcp_check:"end",dhcpCompare:"#txtDhcpIpPoolStart",ip_broadcast_range_check:!0},txtDhcpLease:{digits:!0,range:[1,65535]}},groups:{lanip_check:"txtDhcpIpPoolStart txtDhcpIpPoolEnd"},errorPlacement:function(t,e){"txtDhcpIpPoolStart"==e.attr("name")?t.insertAfter("#txtDhcpIpPoolEnd"):"txtDhcpLease"==e.attr("name")?t.insertAfter("#errorHolder"):t.insertAfter(e)}}),t("#frmMtu").validate({submitHandler:function(){s.saveMtu()},rules:{mtuText:{digits:!0,range:[1300,1500],mtuMssCompare:"#mssText"},mssText:{digits:!0,range:[1260,1460],mtuMssCompare:"#mtuText"}}}),t("#natSettingForm").validate({submitHandler:function(){s.saveNat()}})}function u(t){var e=t.split(".");if(4!=e.length)return!1;if(e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),e[2]=parseInt(e[2]),e[3]=parseInt(e[3]),0!=e[3]){if(255!=e[2]||255!=e[1]||255!=e[0])return!1;if(!o(e[3]))return!1}if(0!=e[2]){if(255!=e[1]||255!=e[0])return!1;if(!o(e[2]))return!1}if(0!=e[1]){if(255!=e[0])return!1;if(!o(e[1]))return!1}return 255==e[0]&&("0.0.0.0"!=t&&"255.255.255.255"!=t)}function c(t,e,n,s){var r,i,a,d,u,c,o;return r=t.indexOf("."),i=t.indexOf(".",r+1),a=t.indexOf(".",i+1),d=l(t.substring(0,r))+l(t.substring(r+1,i))+l(t.substring(i+1,a))+l(t.substring(a+1,t.length)),d="0x"+d,r=e.indexOf("."),i=e.indexOf(".",r+1),a=e.indexOf(".",i+1),u=l(e.substring(0,r))+l(e.substring(r+1,i))+l(e.substring(i+1,a))+l(e.substring(a+1,e.length)),u="0x"+u,r=n.indexOf("."),i=n.indexOf(".",r+1),a=n.indexOf(".",i+1),c=l(n.substring(0,r))+l(n.substring(r+1,i))+l(n.substring(i+1,a))+l(n.substring(a+1,n.length)),c="0x"+c,r=s.indexOf("."),i=s.indexOf(".",r+1),a=s.indexOf(".",i+1),o=l(s.substring(0,r))+l(s.substring(r+1,i))+l(s.substring(i+1,a))+l(s.substring(a+1,s.length)),o="0x"+o,h(d,u)!=h(c,o)}function o(t){return 255==t||254==t||252==t||248==t||240==t||224==t||192==t||128==t||0==t}function p(t,e,n){var s,r,i,a,d,u,c,o,p,f,b;return s=t.indexOf("."),r=t.indexOf(".",s+1),i=t.indexOf(".",r+1),a=l(t.substring(0,s))+l(t.substring(s+1,r))+l(t.substring(r+1,i))+l(t.substring(i+1,t.length)),a="0x"+a,c=t.substring(i+1,t.length)-0,s=e.indexOf("."),r=e.indexOf(".",s+1),i=e.indexOf(".",r+1),d=l(e.substring(0,s))+l(e.substring(s+1,r))+l(e.substring(r+1,i))+l(e.substring(i+1,e.length)),d="0x"+d,o=e.substring(i+1,e.length)-0,s=n.indexOf("."),r=n.indexOf(".",s+1),i=n.indexOf(".",r+1),u=l(n.substring(0,s))+l(n.substring(s+1,r))+l(n.substring(r+1,i))+l(n.substring(i+1,n.length)),u="0x"+u,p=n.substring(i+1,n.length)-0,h(a,d)==h(u,d)&&(f=c&o,b=255-o+(c&o),!(p==f||p==b))}function l(t){var e=(t-0).toString(16);return 1==e.length&&(e="0"+e),e.toUpperCase()}function h(t,e){var n,s=[],r=[],i="0x";for(n=2,j=0;n<10;n+=2,j++)s[j]="0x"+t.substring(n,n+2),r[j]="0x"+e.substring(n,n+2);for(n=0;n<4;n++)i+=l(s[n]&r[n]);return i-0}function f(t,e,n,s,r){i1=n.indexOf("."),i2=n.indexOf(".",i1+1),i3=n.indexOf(".",i2+1),sip=l(n.substring(0,i1))+l(n.substring(i1+1,i2))+l(n.substring(i2+1,i3))+l(n.substring(i3+1,n.length)),sip="0x"+sip,i1=s.indexOf("."),i2=s.indexOf(".",i1+1),i3=s.indexOf(".",i2+1),eip=l(s.substring(0,i1))+l(s.substring(i1+1,i2))+l(s.substring(i2+1,i3))+l(s.substring(i3+1,s.length)),eip="0x"+eip,i1=t.indexOf("."),i2=t.indexOf(".",i1+1),i3=t.indexOf(".",i2+1);l(t.substring(0,i1)),l(t.substring(i1+1,i2)),l(t.substring(i2+1,i3)),l(parseInt(t.substring(i3+1,t.length))+18);return t=l(t.substring(0,i1))+l(t.substring(i1+1,i2))+l(t.substring(i2+1,i3))+l(t.substring(i3+1,t.length)),t="0x"+t,sip>eip?1:t>=sip&&t<=eip?2:0}var b=!1,g="",v="";return t.validator.addMethod("ip_broadcast_check",function(e,n,s){var r=get_network_broadcast_addr(t("#txtSubnetMask").val(),t("#txtIpAddress").val()),i=r[0],a=r[1];if(""==i)return!0;var d=e!=i&&e!=a;return this.optional(n)||d}),t.validator.addMethod("ip_broadcast_range_check",function(e,n,s){var r=get_network_broadcast_addr(t("#txtSubnetMask").val(),t("#txtIpAddress").val()),i=parseInt(r[0].split(".")[3]),a=parseInt(r[1].split(".")[3]);if(isNaN(i)||isNaN(a))return!0;var d=parseInt(t("#txtDhcpIpPoolStart").val()),u=parseInt(t("#txtDhcpIpPoolEnd").val()),c=(i<d||i>u)&&(a<d||a>u);return this.optional(n)||c}),t.validator.addMethod("subnetmask_check",function(t,e,n){var s=u(t);return this.optional(e)||s}),t.validator.addMethod("dhcp_check",function(e,n,s){var r="start"==s?t("#txtDhcpIpPoolStart").val():t("#txtDhcpIpPoolEnd").val(),i=p(t("#txtIpAddress").val(),t("#txtSubnetMask").val(),r);return this.optional(n)||i}),t.validator.addMethod("dhcpCompare",function(e,n,s){return 1!=("#txtDhcpIpPoolStart"==s?f(t("#txtIpAddress").val(),t("#txtSubnetMask").val(),t(s).val(),e):f(t("#txtIpAddress").val(),t("#txtSubnetMask").val(),e,t(s).val()))}),t.validator.addMethod("ipRange",function(e,n,s){var r=!1;return t("#dhcpEnable").is(":checked")&&(r=!0),2!=f(e,t("#txtSubnetMask").val(),t("#txtDhcpIpPoolStart").val(),t("#txtDhcpIpPoolEnd").val(),r)}),t.validator.addMethod("mtuMssCompare",function(e,n,s){return 1!=("#mtuText"==s?t(s).val()-t("#mssText").val()<40:t("#mtuText").val()-t(s).val()<40)}),{init:d}});
//# sourceMappingURL=../../sourcemaps/adm/lan.js.map
