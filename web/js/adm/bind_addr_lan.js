define(["jquery","knockout","config/config","service","underscore"],function(s,e,r,t,i){function a(){var i=this,a=t.getStaticMacIpAddressList(),o=t.getDHCPStaticAddressRules(),u=t.getBindIPInfo();i.rules=e.observableArray(a.StaticAddressFilterRules),i.hostName=e.observable(u.host_name_web),i.macAddress=e.observable(u.mac_addr_web),i.ipAddress=e.observable(u.ip_addr_web),i.gridTemplate=new e.simpleGrid.viewModel({data:i.rules(),idName:"index",primaryColumn:"macAddress",columns:f,tmplType:"list",pageSize:10}),i.macIpBindEnable=e.observable(o.mac_ip_status),i.orimacIpBindEnable=o.mac_ip_status,i.isShowStaticAddressDiv=e.observable(!1),1==o.mac_ip_status?i.isShowStaticAddressDiv(!0):i.isShowStaticAddressDiv(!1),i.clear=function(){s("#txtMacAddress").val(""),s("#txtIpAddress").val(""),s("#hostName").focus()},i.callback=function(e){"success"==e.result?(i.clear(),A(),successOverlay(),s("#staticAddress").translate()):errorOverlay()},i.setBindSwitch=function(){showLoading();var e={};e.mac_ip_status=i.macIpBindEnable(),t.setBindMacIpSwitch(e,function(e){"success"==e.result?(successOverlay(),i.clear(),A(),s("#staticAddress").translate()):errorOverlay()})},i.addRule=function(){if(i.rules().length>=r.staticMacIPAddress)return showAlert({msg:"mac_ip_address_filter_max",params:r.staticMacIPAddress}),!1;if(u.ipAddress==i.ipAddress())return showAlert("ip_gate_not_same"),!1;if(!n(u.ipAddress,u.subnetMask,i.ipAddress()))return showAlert("static_address_check"),!1;if(!d(i.ipAddress(),a))return showAlert("the_only_ipAddress"),!1;if(!c(i.macAddress(),a))return showAlert("the_only_macAddress"),!1;showLoading();var s={goformId:"BIND_STATIC_ADDRESS_ADD",mac_address:i.macAddress(),ip_address:i.ipAddress()};t.addStaticAddress(s,i.callback)},i.deleteRule=function(){showConfirm("confirm_data_delete",function(){showLoading();var s={goformId:"BIND_STATIC_ADDRESS_DEL",mac_address:i.gridTemplate.selectedPrimaryValue().join(";")+";"};t.delStaticAddrRules(s,i.callback)})},i.restart=function(){showConfirm("restart_confirm",function(){showLoading("restarting"),t.restart({},function(s){s&&"success"==s.result?successOverlay():errorOverlay()},s.noop)})}}function n(s,e,r){return l(s,e,r)}function d(e,r){for(var t=r.StaticAddressFilterRules,i=e,a=[],n=[],d=0;d<t.length;d++){var c={};c.ipAddress=t[d].ipAddress,a.push(c)}for(var d=0;d<a.length;d++)n.push(a[d].ipAddress);return-1==s.inArray(i,n)}function c(e,r){for(var t=r.StaticAddressFilterRules,i=e,a=[],n=[],d=0;d<t.length;d++){var c={};c.macAddress=t[d].macAddress,a.push(c)}for(var d=0;d<a.length;d++)n.push(a[d].macAddress);return-1==s.inArray(i,n)}function o(s){var e=(s-0).toString(16);return 1==e.length&&(e="0"+e),e.toUpperCase()}function u(s,e){var r,t=[],i=[],a="0x";for(r=2,j=0;r<10;r+=2,j++)t[j]="0x"+s.substring(r,r+2),i[j]="0x"+e.substring(r,r+2);for(r=0;r<4;r++)a+=o(t[r]&i[r]);return a-0}function l(s,e,r){var t,i,a,n,d,c,l,A,f,m,p;return t=s.indexOf("."),i=s.indexOf(".",t+1),a=s.indexOf(".",i+1),n=o(s.substring(0,t))+o(s.substring(t+1,i))+o(s.substring(i+1,a))+o(s.substring(a+1,s.length)),n="0x"+n,l=s.substring(a+1,s.length)-0,t=e.indexOf("."),i=e.indexOf(".",t+1),a=e.indexOf(".",i+1),d=o(e.substring(0,t))+o(e.substring(t+1,i))+o(e.substring(i+1,a))+o(e.substring(a+1,e.length)),d="0x"+d,A=e.substring(a+1,e.length)-0,t=r.indexOf("."),i=r.indexOf(".",t+1),a=r.indexOf(".",i+1),c=o(r.substring(0,t))+o(r.substring(t+1,i))+o(r.substring(i+1,a))+o(r.substring(a+1,r.length)),c="0x"+c,f=r.substring(a+1,r.length)-0,u(n,d)==u(c,d)&&(m=l&A,p=255-A+(l&A),!(f==m||f==p))}function A(){var r=s("#container");e.cleanNode(r[0]);var t=new a;e.applyBindings(t,r[0]),s("#bindMACIPSwitchFrm").validate({submitHandler:function(){t.setBindSwitch()}}),s("#bindMACIPContentFrm").validate({submitHandler:function(){t.addRule()},rules:{txtMacAddress:{mac_check:!0},txtIpAddress:{ip_check:!0}},errorPlacement:function(s,e){"txtMacAddress"==e.attr("name")&&s.appendTo("#macErrorDiv"),"txtIpAddress"==e.attr("name")&&s.appendTo("#ipErrorDiv")}}),s("#bindMACIPListFrm").validate({submitHandler:function(){t.deleteRule()}})}var f=[{columnType:"checkbox",rowText:"index",width:"10%"},{headerTextTrans:"mac_address",rowText:"macAddress",width:"30%",trans:!0},{headerTextTrans:"ip_address",rowText:"ipAddress",width:"30%",trans:!0}];return{init:A}});
//# sourceMappingURL=../../sourcemaps/adm/bind_addr_lan.js.map
