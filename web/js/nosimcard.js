define(["knockout","service","jquery","config/config","home","opmode/opmode","status/statusBar"],function(e,i,n,t,o,a,s){function r(){function o(e){var i=(new Date).getTime();return e.QrImageUrl?e.QrImageUrl+"?_="+i:""}function a(){var e=i.getDeviceInfo();return c.simSerialNumber(verifyDeviceInfo(e.simSerialNumber)),c.imei(verifyDeviceInfo(e.imei)),c.imsi(verifyDeviceInfo(e.imsi)),c.wifiLongMode("wifi_des_"+e.wifiRange),e}function r(){var e=a();m.initShownStatus(e);var o=m.getWanIpAddr(e),s=i.getStatusInfo(),r=!1;t.AP_STATION_SUPPORT&&"connect"==s.connectWifiStatus&&(r=!0);var d=_.template(n("#detailInfoTmpl").html()),p=d({simSerialNumber:verifyDeviceInfo(e.simSerialNumber),imei:verifyDeviceInfo(e.imei),imsi:verifyDeviceInfo(e.imsi),signal:signalFormat(e.signal),hasWifi:t.HAS_WIFI&&"1"==c.wifi_enable(),isCPE:"CPE"==t.PRODUCT_TYPE,showMultiSsid:t.HAS_MULTI_SSID&&"1"==e.multi_ssid_enable,ssid:verifyDeviceInfo(e.ssid),max_access_num:verifyDeviceInfo(e.max_access_num),m_ssid:verifyDeviceInfo(e.ssidGuest),m_max_access_num:verifyDeviceInfo(e.max_access_num_guest),ssid_5g:verifyDeviceInfo(e.m_ssid),m_ssid_5g:verifyDeviceInfo(e.m_ssid_guest),max_access_num_5g:verifyDeviceInfo(e.m_max_access_num),m_max_access_num_5g:verifyDeviceInfo(e.m_max_access_num_guest),show24GMainSsid:"1"==e.chip1_ssid1_enable,show5GMainSsid:"1"==e.chip2_ssid1_enable,wifi_long_mode:"wifi_des_"+e.wifiRange,lanDomain:verifyDeviceInfo(e.lanDomain),ipAddress:verifyDeviceInfo(e.ipAddress),showMacAddress:t.SHOW_MAC_ADDRESS,macAddress:verifyDeviceInfo(e.macAddress),showIpv4WanIpAddr:m.initStatus.showIpv4WanIpAddr,wanIpAddress:r?e.station_ip_addr:o.wanIpAddress,showIpv6WanIpAddr:m.initStatus.showIpv6WanIpAddr,ipv6WanIpAddress:o.ipv6WanIpAddress,sw_version:verifyDeviceInfo(e.sw_version),fw_version:verifyDeviceInfo(e.fw_version),hw_version:verifyDeviceInfo(e.hw_version)});return n(p).translate()}function I(){var e=i.getLoginData(),n=v(e);n==c.pageState.LOADING?addTimeout(I,500):(c.page(n),c.pinNumber(e.pinnumber),c.pukNumber(e.puknumber))}function v(e){var i=e.modem_main_state;return"modem_sim_undetected"==i||"modem_undetected"==i||"modem_sim_destroy"==i?c.pageState.NO_SIM:-1!=n.inArray(i,t.TEMPORARY_MODEM_MAIN_STATE)?c.pageState.LOADING:"modem_waitpin"==i?c.pageState.WAIT_PIN:"modem_waitpuk"!=i&&0!=e.pinnumber||0==e.puknumber?0!=e.puknumber&&"modem_sim_destroy"!=i||"modem_sim_undetected"==i||"modem_undetected"==i?void location.reload():c.pageState.PUK_LOCKED:c.pageState.WAIT_PUK}var c=this,u=d(),f=p(),P=i.getParams({nv:["OOM_TEMP_PRO"]}).OOM_TEMP_PRO;c.oom_temp_pro=P,c.wifi_enable=e.observable(u.wifiSwitch),c.supportModeChange=!(void 0!==t.OPMODE_CHANGE_SUPPORT&&!t.OPMODE_CHANGE_SUPPORT),c.pageState={NO_SIM:0,WAIT_PIN:1,WAIT_PUK:2,PUK_LOCKED:3,LOADING:4},c.isSupportSD=t.SD_CARD_SUPPORT,c.isCPE="CPE"==t.PRODUCT_TYPE,c.showQrCode=e.observable(!("0"==u.QrImageShow)&&"1"==u.wifiSwitch),c.qrcodeSrc=e.observable(o(u)),c.showQrCode_5g=e.observable(!("0"==f.QrImageShow)&&"1"==u.wifiSwitch),c.qrcodeSrc_5g=e.observable(o(f)),c.isHomePage=e.observable(!1),"#home"==window.location.hash&&c.isHomePage(!0);var w=i.getLoginData();c.PIN=e.observable(),c.PUK=e.observable(),c.newPIN=e.observable(),c.confirmPIN=e.observable(),c.pinNumber=e.observable(w.pinnumber),c.pukNumber=e.observable(w.puknumber),c.isLoggedIn=e.observable(!1),c.enableFlag=e.observable(!1),c.simSerialNumber=e.observable(""),c.imei=e.observable(""),c.imsi=e.observable(""),c.wifiLongMode=e.observable(""),c.connectStatus=e.observable(w.connectStatus);var g=v(w);c.page=e.observable(g),g==c.pageState.LOADING&&addTimeout(I,500),c.showOpModeWindow=function(){showSettingWindow("change_mode","opmode/opmode_popup","opmode/opmode_popup",400,300,function(){})},c.isCPE&&i.getOpMode({},function(e){c.isLoggedIn("ok"==e.loginfo),"DHCP"==e.opms_wan_mode||"AUTO_DHCP"==e.opms_wan_mode?c.enableFlag(!0):"ppp_disconnected"!=e.ppp_status?c.enableFlag(!1):c.enableFlag(!0),"DHCP"==e.opms_wan_mode||"STATIC"==e.opms_wan_mode?mode="PPPOE":"AUTO_DHCP"==e.opms_wan_mode||"AUTO_PPPOE"==e.opms_wan_mode||"AUTO_LTE_GATEWAY"==e.opms_wan_mode?mode="AUTO":mode=e.opms_wan_mode;var i="";switch(mode){case"LTE_BRIDGE":i="opmode_bridge";break;case"AUTO":i="opmode_auto";break;case"PPPOE":i="opmode_cable";break;case"PPP":i="opmode_gateway";break;case"AUTO_BACKUP":i="opmode_autobackup"}n("#opmode").attr("data-trans",i).text(n.i18n.prop(i))});var S=!1;n("#showDetailInfo").popover({html:!0,placement:"top",trigger:"focus",title:function(){return n.i18n.prop("device_info")},content:function(){return r()}}).on("shown.bs.popover",function(){S=!0;var e=n("#topContainer").outerHeight();n(window).scrollTop()>e&&n(window).scrollTop(e)}).on("hidden.bs.popover",function(){S=!1}),a(),setTimeout(function(){var e=i.getParams({nv:["privacy_read_flag","loginfo","tr069_user_improv_notify_flag","dm_user_grant_notify_flag"]});"0"==e.privacy_read_flag&&"ok"==e.loginfo&&t.HAS_GDPR?showModifyFotaWindow("change_mode","privacy_policy","privacy_policy",700,400,function(){}):"0"==e.tr069_user_improv_notify_flag&&"ok"==e.loginfo?showModifyFotaWindow("change_mode","user_improv","user_improv",700,400,function(){}):"0"==e.dm_user_grant_notify_flag&&"ok"==e.loginfo?showModifyFotaWindow("change_mode","user_grant","user_grant",700,400,function(){}):s.setRedirectTips(!0)},1e3),c.enterPIN=function(){showLoading(),c.page(c.pageState.LOADING);var e=c.PIN();i.enterPIN({PinNumber:e},function(e){e.result||(hideLoading(),showAlert("pin_error",function(){I()}),c.PIN("")),I(),c.page()==c.pageState.WAIT_PUK&&hideLoading()})},c.enterPUK=function(){showLoading(),c.page(c.pageState.LOADING);var e=c.newPIN(),n=(c.confirmPIN(),{});n.PinNumber=e,n.PUKNumber=c.PUK(),i.enterPUK(n,function(e){e.result?(I(),c.page()==c.pageState.PUK_LOCKED&&hideLoading()):(hideLoading(),showAlert("puk_error",function(){I(),c.page()==c.pageState.PUK_LOCKED&&hideLoading()}),c.PUK(""),c.newPIN(""),c.confirmPIN(""))})},addInterval(function(){i.getSignalStrength({},function(e){var i=signalFormat("CPE"==t.PRODUCT_TYPE?e.rssi:convertSignal(e));n("#fresh_signal_strength").text(i),S&&n("#popoverSignalTxt").text(i)})},1e3)}function d(){var e=i.getWifiModuleSwitchStatus(),n=i.getWifiAccessPointInfo();return wifiFilterAPInfo(e,n,t.WIFICHIPINDEX.FIRST,t.ACCESSPOINTINDEX.FIRST,t.WIFICHIPINDEX,t.ACCESSPOINTINDEX)}function p(){var e=i.getWifiModuleSwitchStatus(),n=i.getWifiAccessPointInfo();return wifiFilterAPInfo(e,n,t.WIFICHIPINDEX.SECOND,t.ACCESSPOINTINDEX.FIRST,t.WIFICHIPINDEX,t.ACCESSPOINTINDEX)}function I(){var t=n("#container")[0];e.cleanNode(t);var o=new r;if(e.applyBindings(o,t),n("#frmPIN").validate({submitHandler:function(){o.enterPIN()},rules:{txtPIN:"pin_check"}}),n("#frmPUK").validate({submitHandler:function(){o.enterPUK()},rules:{txtNewPIN:"pin_check",txtConfirmPIN:{equalToPin:"#txtNewPIN"},txtPUK:"puk_check"}}),""==rd0||""==rd1){var a=i.getLanguage();rd0=a.rd_params0,rd1=a.rd_params1}}var m={initStatus:null,initShownStatus:function(e){this.initStatus={};var i=e.ipv6PdpType.toLowerCase().indexOf("v6")>0;"CPE"==t.PRODUCT_TYPE?"LTE_BRIDGE"==e.opms_wan_mode?(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!1):"DHCP"==e.opms_wan_mode||"PPPOE"==e.opms_wan_mode?(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0):"STATIC"==e.opms_wan_mode?(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0):t.IPV6_SUPPORT?"IP"==e.pdpType?(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0):i&&("IPv6"==e.ipv6PdpType?(this.initStatus.showIpv6WanIpAddr=!0,this.initStatus.showIpv4WanIpAddr=!1):(this.initStatus.showIpv6WanIpAddr=!0,this.initStatus.showIpv4WanIpAddr=!0)):(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0):t.IPV6_SUPPORT?"IP"==e.pdpType?(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0):i&&("IPv6"==e.ipv6PdpType?(this.initStatus.showIpv6WanIpAddr=!0,this.initStatus.showIpv4WanIpAddr=!1):(this.initStatus.showIpv6WanIpAddr=!0,this.initStatus.showIpv4WanIpAddr=!0)):(this.initStatus.showIpv6WanIpAddr=!1,this.initStatus.showIpv4WanIpAddr=!0)},getWanIpAddr:function(e){var i={wanIpAddress:"",ipv6WanIpAddress:""};if("DHCP"==e.opms_wan_mode||"PPPOE"==e.opms_wan_mode)i.wanIpAddress=verifyDeviceInfo(e.wanIpAddress);else if("STATIC"==e.opms_wan_mode)i.wanIpAddress=verifyDeviceInfo(e.staticWanIpAddress);else{var n=this.getConnectStatus(e.connectStatus);1==n?(i.wanIpAddress=verifyDeviceInfo(e.wanIpAddress),i.ipv6WanIpAddress="— —"):2==n?(i.wanIpAddress="— —",i.ipv6WanIpAddress=verifyDeviceInfo(e.ipv6WanIpAddress)):3==n?(i.wanIpAddress=verifyDeviceInfo(e.wanIpAddress),i.ipv6WanIpAddress=verifyDeviceInfo(e.ipv6WanIpAddress)):(i.wanIpAddress="— —",i.ipv6WanIpAddress="— —")}return i},getConnectStatus:function(e){return"ppp_disconnected"==e||"ppp_connecting"==e||"ppp_disconnecting"==e?0:"ppp_connected"==e?1:"ipv6_connected"==e?2:"ipv4_ipv6_connected"==e?3:void 0}};return{init:I}});
//# sourceMappingURL=../sourcemaps/nosimcard.js.map
