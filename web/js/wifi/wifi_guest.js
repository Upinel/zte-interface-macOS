define(["jquery","knockout","config/config","service","underscore"],function(e,s,t,i,a){function o(e){for(var s=[],t=1;t<=e;t++)s.push(new Option(t,t));return s}function n(){function a(e){var s=(new Date).getTime();return e.QrImageUrl?e.QrImageUrl+"?_="+s:""}var n=this,r=i.getWifiModuleSwitchStatus(),l=i.getWifiAccessPointInfo(),m=wifiFilterAPInfo(r,l,t.WIFICHIPINDEX.FIRST,t.ACCESSPOINTINDEX.SECOND,t.WIFICHIPINDEX,t.ACCESSPOINTINDEX);i.getWiFiGuestLeftTime();n.hasWifiSwitch=t.WIFI_SWITCH_SUPPORT,n.hasGuestSSIDControl=t.WIFI_GUEST_SSID_ACCESS_SUPPORT,n.hasQRImg=t.WIFI_SUPPORT_QR_CODE,n.hasWifiMacFilter=t.WIFI_MAC_FILTER_SUPPORT,n.hasMultiSSID=t.HAS_MULTI_SSID,n.hasWifiDoubleChip=t.WIFI_DOUBLE_CHIP,n.showIsolated=t.SHOW_WIFI_AP_ISOLATED,n.wifi_enable=s.observable(m.wifiSwitch),n.accessPoint24gEnable=s.observable(m.AccessPointSwitchStatus),n.originAccessPoint24gEnable=s.observable(m.AccessPointSwitchStatus),n.isShowSSIDInfoDiv=s.observable(!1);var u=i.getParams({nv:"lan_sec_ssid_control"}).lan_sec_ssid_control;n.lan_sec_ssid_control=s.observable(u),t.WIFI_SWITCH_SUPPORT?"0"!=m.wifiSwitch?n.isShowSSIDInfoDiv(!0):n.isShowSSIDInfoDiv(!1):n.isShowSSIDInfoDiv(!0);var f=i.getParams({nv:"wifi_chip1_ssid2_access_sta_mac"}).wifi_chip1_ssid2_access_sta_mac;n.m_CurrentUser=""==f?s.observable(0):s.observable(f.split(";").length-1);var w="OPEN"==m.AuthMode;n.securityModeChangeHandler=function(){w&&(n.m_passPhrase(""),clearValidateMsg("#passwordContainer")),w="OPEN"==n.m_selectedMode()};var I="OPEN"==m.AuthMode_5g;n.securityModeChangeHandler_5g=function(){I&&(n.m_passPhrase_5g(""),clearValidateMsg("#passwordContainer")),I="OPEN"==n.m_selectedMode_5g()},n.maxStationNumber=s.computed(function(){return t.MAX_STATION_NUMBER}),n.m_modes=s.observableArray(S),n.m_selectedMode=s.observable(m.AuthMode),n.m_activeTimeModes=s.observableArray(h),n.m_passPhrase=s.observable(m.Password),n.m_showPassword=s.observable(!1),n.m_ssid=s.observable(m.SSID),n.m_broadcast=s.observable("1"==m.ApBroadcastDisabled?"1":"0"),n.m_apIsolation=s.observable("1"==m.ApIsolate?"1":"0"),n.m_cipher=m.cipher,n.m_selectedStation=s.observable(m.ApMaxStationNumber),n.m_maxStations=s.observableArray(o(t.MAX_STATION_NUMBER)),n.m_selectedActiveTime=s.observable(m.GuestSSIDActiveTime),n.leftSeconds=s.observable(0),n.m_guestWiFiLeftTime=s.observable(transSecond2Time(n.leftSeconds())),n.m_showQrCode=s.observable(!("0"==m.QrImageShow)),n.m_qrcode_ssid1=s.observable(a(m)),n.m_showQrCodeHandler=function(){e("#m_showQrCode").parent().find(".error").hide();var s=e("#m_showQrCode:checked");s&&0==s.length?n.m_showQrCode(!0):n.m_showQrCode(!1)};var b=wifiFilterAPInfo(r,l,t.WIFICHIPINDEX.SECOND,t.ACCESSPOINTINDEX.SECOND,t.WIFICHIPINDEX,t.ACCESSPOINTINDEX);n.m_showQrCode_5g=s.observable(!("0"==b.QrImageShow)),n.m_qrcode_ssid1_5g=s.observable(a(b)),n.m_showQrCodeHandler_5g=function(){e("#m_showQrCode_5g").parent().find(".error").hide();var s=e("#m_showQrCode_5g:checked");s&&0==s.length?n.m_showQrCode_5g(!0):n.m_showQrCode_5g(!1)},n.accessPoint50gEnable=s.observable(b.AccessPointSwitchStatus),n.originAccessPoint50gEnable=s.observable(b.AccessPointSwitchStatus),n.m_modes_5g=s.observableArray(S),n.m_selectedMode_5g=s.observable(b.AuthMode),n.m_passPhrase_5g=s.observable(b.Password),n.m_showPassword_5g=s.observable(!1),n.m_ssid_5g=s.observable(b.SSID),n.m_broadcast_5g=s.observable("1"==b.ApBroadcastDisabled?"1":"0"),n.m_apIsolation_5g=s.observable("1"==b.ApIsolate?"1":"0"),n.m_cipher_5g=b.cipher,n.m_selectedStation_5g=s.observable(b.ApMaxStationNumber),n.m_maxStations_5g=s.observableArray(o(t.MAX_STATION_NUMBER)),n.clear=function(e){"switch"==e?(n.multi_ssid_enable(m.multi_ssid_enable),n.wifi_enable(m.wifiSwitch)):"ssid1"==e?(n.selectedMode(m.AuthMode),n.passPhrase(m.Password),n.ssid(m.SSID),n.broadcast("1"==m.ApBroadcastDisabled?"1":"0"),n.cipher=m.cipher,n.selectedStation(m.ApMaxStationNumber),n.apIsolation("1"==m.ApIsolate?"1":"0")):"ssid2"==e?(n.m_selectedMode(m.m_AuthMode),n.m_passPhrase(m.m_passPhrase),n.m_ssid(m.m_SSID),n.m_broadcast("1"==m.m_broadcast?"1":"0"),n.m_cipher=m.m_cipher,n.m_selectedStation(m.m_MAX_Access_num),n.m_apIsolation("1"==m.m_apIsolation?"1":"0")):(clearTimer(),clearValidateMsg(),_(n))},n.checkSettings=function(e){var s=c(),t=(i.getStatusInfo(),i.getAPStationBasic());return"ssid2"==e&&"1"==t.ap_station_enable&&"1"==n.accessPoint24gEnable()?(showAlert("ap_station_note_disable_info"),!0):"switch"!=e||"1"!=s.WpsStatus_1&&"1"!=s.WpsStatus_2?"ssid1"==e&&"1"==s.WpsStatus_1?(showAlert("wps_on_info"),!0):"ssid2"==e&&"1"==s.WpsStatus_2&&(showAlert("wps_on_info"),!0):(showAlert("wps_on_info"),!0)},n.saveSSID2=function(){n.checkSettings("ssid1")||showConfirm("wifi_disconnect_confirm",function(){n.saveSSID2Action()})},n.saveSSID2Action=function(){showLoading(),n.m_broadcast(e("#mBroadcastCheckbox:checked").length>0?"0":"1"),n.m_apIsolation(e("#mApIsolatedCheckbox:checked").length);var s={};s.ChipIndex="0",s.AccessPointIndex="1",s.AccessPointSwitchStatus=n.accessPoint24gEnable(),s.originAccessPointSwitchStatus=n.originAccessPoint24gEnable(),s.AuthMode=n.m_selectedMode(),s.Password=n.m_passPhrase(),s.SSID=n.m_ssid(),s.ApBroadcastDisabled=n.m_broadcast(),s.QrImageShow=n.m_showQrCode()?"1":"0",s.ApMaxStationNumber=n.m_selectedStation(),s.cipher="WPA2PSK"==n.m_selectedMode()?"CCMP":"TKIPCCMP",s.ApIsolate=n.m_apIsolation(),s.GuestSSIDActiveTime=n.m_selectedActiveTime(),i.setWifiAccessPointInfo(s,function(e){"success"==e.result?n.checkWifiStatus():errorOverlay()})},n.saveSSID2_5g=function(){n.checkSettings("ssid2")||showConfirm("wifi_disconnect_confirm",function(){n.saveSSID2Action_5g()})},n.saveSSID2Action_5g=function(){showLoading(),n.m_broadcast_5g(e("#mBroadcastCheckbox_5g:checked").length>0?"0":"1"),n.m_apIsolation_5g(e("#mApIsolatedCheckbox_5g:checked").length);var s={};s.ChipIndex="1",s.AccessPointIndex="1",s.AccessPointSwitchStatus=n.accessPoint50gEnable(),s.originAccessPointSwitchStatus=n.originAccessPoint50gEnable(),s.AuthMode=n.m_selectedMode_5g(),s.Password=n.m_passPhrase_5g(),s.SSID=n.m_ssid_5g(),s.ApBroadcastDisabled=n.m_broadcast_5g(),s.QrImageShow=n.m_showQrCode_5g()?"1":"0",s.ApMaxStationNumber=n.m_selectedStation_5g(),s.cipher="WPA2PSK"==n.m_selectedMode_5g()?"CCMP":"TKIPCCMP",s.ApIsolate=n.m_apIsolation_5g(),i.setWifiAccessPointInfo(s,function(e){"success"==e.result?n.checkWifiStatus():errorOverlay()})},n.setMultiSSIDSwitch=function(){if(!n.checkSettings("switch")){var s=function(){showLoading();var s={};t.WIFI_SWITCH_SUPPORT&&(s.SwitchOption=n.wifi_enable(),n.lan_sec_ssid_control(e("#allowAccessCheckbox:checked").length>0?"0":"1"),s.lan_sec_ssid_control=n.lan_sec_ssid_control()),i.setWifiModuleSwitchStatus(s,function(e){"success"==e.result?n.checkWifiStatus():errorOverlay()})};"0"==n.wifi_enable()?showConfirm("wifi_off_alert",function(){s()}):s()}},n.checkWifiStatus=function(){function e(){var s=i.getWifiModuleSwitchStatus();"0"!=s.WiFiModuleSwitch&&"1"!=s.WiFiModuleSwitch?addTimeout(e,1e3):setTimeout(function(){successOverlay(),d&&setTimeout(function(){window.location.reload()},1e3),clearTimer(),clearValidateMsg(),_()},d?15e3:0)}setTimeout(function(){e()},2e3)},n.setGuestSSIDSwitch=function(){if(!n.checkSettings("ssid2")){!function(){showLoading();var s={};s.AccessPointSwitchStatus=n.accessPoint24gEnable(),n.lan_sec_ssid_control(e("#allowAccessCheckbox:checked").length>0?"0":"1"),s.lan_sec_ssid_control=n.lan_sec_ssid_control(),showLoading(),n.m_broadcast(e("#mBroadcastCheckbox:checked").length>0?"0":"1"),n.m_apIsolation(e("#mApIsolatedCheckbox:checked").length);var s={};s.ChipIndex="0",s.AccessPointIndex="1",s.AccessPointSwitchStatus=n.accessPoint24gEnable(),s.originAccessPointSwitchStatus=n.originAccessPoint24gEnable(),n.lan_sec_ssid_control(e("#allowAccessCheckbox:checked").length>0?"0":"1"),s.lan_sec_ssid_control=n.lan_sec_ssid_control(),s.AuthMode=n.m_selectedMode(),s.Password=n.m_passPhrase(),s.SSID=n.m_ssid(),s.ApBroadcastDisabled=n.m_broadcast(),s.QrImageShow=n.m_showQrCode()?"1":"0",s.ApMaxStationNumber=n.m_selectedStation(),s.cipher="WPA2PSK"==n.m_selectedMode()?"CCMP":"TKIPCCMP",s.ApIsolate=n.m_apIsolation(),i.setWifiAccessPointInfo(s,function(e){"success"==e.result?n.checkWifiStatus():errorOverlay()})}()}},n.showPasswordHandler=function(){e("#passShow").parent().find(".error").hide();var s=e("#showPassword:checked");s&&0==s.length?n.showPassword(!0):n.showPassword(!1)},n.m_showPasswordHandler=function(){e("#m_passShow").parent().find(".error").hide();var s=e("#m_showPassword:checked");s&&0==s.length?n.m_showPassword(!0):n.m_showPassword(!1)},n.m_showPasswordHandler_5g=function(){e("#m_passShow_5g").parent().find(".error").hide();var s=e("#m_showPassword_5g:checked");s&&0==s.length?n.m_showPassword_5g(!0):n.m_showPassword_5g(!1)},n.startWiFiGuestLeftTimeInterval=function(){i.getWiFiGuestLeftTime({},function(e){n.leftSeconds(e.WiFiGuestLeftTime),activeLeftTimer=setInterval(function(e){n.leftSeconds()<=0&&n.leftSeconds(0),n.leftSeconds(n.leftSeconds()>0?n.leftSeconds()-1:0),n.m_guestWiFiLeftTime(transSecond2Time(n.leftSeconds()))},1e3)})}}function c(){var e=i.getWifiWpsStatus();return wifiWPSActiveInfo(e)}function r(){i.getParams({nv:"user_ip_addr"},function(e){i.getParams({nv:"station_list"},function(s){d=isWifiConnected(e.user_ip_addr,s.station_list)})})}function _(a){var o=e("#container");s.cleanNode(o[0]),l=!a;var c=new n;s.applyBindings(c,o[0]),addTimeout(function(){r()},600),c.startWiFiGuestLeftTimeInterval(),t.AP_STATION_SUPPORT?function(){"1"==i.getAPStationBasic().ap_station_enable?e("#frmMultiSSID :input").each(function(){e(this).attr("disabled",!0)}):e("#frmMultiSSID :input").each(function(){e(this).attr("disabled",!1)})}():t.WDS_SUPPORT&&function(){"0"!=i.getWdsInfo().currentMode?(e("#frmWifiSwitch :input").each(function(){e(this).attr("disabled",!0)}),e("#frmSSID1 :input").each(function(){e(this).attr("disabled",!0)}),e("#frmSSID2 :input").each(function(){e(this).attr("disabled",!0)}),e("#frmGuestSSIDSwitch :input").each(function(){e(this).attr("disabled",!0)})):(e("#frmWifiSwitch :input").each(function(){e(this).attr("disabled",!1)}),e("#frmSSID1 :input").each(function(){e(this).attr("disabled",!1)}),e("#frmSSID2 :input").each(function(){e(this).attr("disabled",!1)}),e("#frmGuestSSIDSwitch :input").each(function(){e(this).attr("disabled",!1)}))}(),addInterval(function(){if("1"==c.accessPoint24gEnable()){var e=i.getParams({nv:"wifi_chip1_ssid2_access_sta_mac"}).wifi_chip1_ssid2_access_sta_mac;""==e?c.m_CurrentUser(0):c.m_CurrentUser(e.split(";").length-1)}},2e3),e("#frmWifiSwitch").validate({submitHandler:function(){c.setMultiSSIDSwitch()}}),e("#frmGuestSSIDSwitch").validate({submitHandler:function(){c.setGuestSSIDSwitch()}}),e("#frmSSID2").validate({submitHandler:function(){c.saveSSID2()},rules:{m_ssid:"ssid",m_pass:"wifi_password_check",m_passShow:"wifi_password_check"},errorPlacement:function(e,s){var t=s.attr("id");"pass"==t||"passShow"==t?e.insertAfter("#lblShowPassword"):"m_pass"==t||"m_passShow"==t?e.insertAfter("#m_lblShowPassword"):e.insertAfter(s)}}),e("#frmSSID2_5g").validate({submitHandler:function(){c.saveSSID2_5g()},rules:{m_ssid_5g:"ssid",m_pass_5g:"wifi_password_check",m_passShow_5g:"wifi_password_check"},errorPlacement:function(e,s){var t=s.attr("id");"pass_5g"==t||"passShow_5g"==t?e.insertAfter("#lblShowPassword_5g"):"m_pass_5g"==t||"m_passShow_5g"==t?e.insertAfter("#m_lblShowPassword_5g"):e.insertAfter(s)}}),e("#m_passStrength").removeClass().addClass("passStrength0"),PasswordStrength("m_pass","m_passStrength"),PasswordStrength("m_passShow","m_passStrength")}var d=!1,l=!0,S=a.map(t.AUTH_MODES,function(e){return new Option(e.name,e.value)}),h=a.map(t.ACTIVE_TIME_MODES,function(e){return new Option(e.name,e.value)});return{init:_}});
//# sourceMappingURL=../../sourcemaps/wifi/wifi_guest.js.map
