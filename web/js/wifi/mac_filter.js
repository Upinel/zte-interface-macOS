define(["knockout","service","jquery","config/config","underscore"],function(a,e,i,t,l){function s(){function t(a,t){if("1"==e.getWpsInfo().wpsFlag)return showAlert("wps_on_info"),!1;var l=i.extend({},a);e.setMacFilter(l,function(a){"success"==a.result?(successOverlay(),r.macFilterEnable(l.ACL_mode),r.blackList(s(l.wifi_hostname_black_list,l.wifi_mac_black_list)),r.blackListEnabled("2"==l.ACL_mode),n.ACL_mode=l.ACL_mode,n.wifi_hostname_black_list=l.wifi_hostname_black_list,n.wifi_mac_black_list=l.wifi_mac_black_list,i("#blacklist").translate(),i("#"+t).attr("disabled",!0)):errorOverlay()})}function s(a,e){if(""==e)return[];for(var i=a.split(";"),t=e.split(";"),l=[],s=0;s<t.length;s++){var c={};c.hostName=i[s],c.macAddress=t[s],l.push(c)}return l}function c(){"2"==n.ACL_mode&&e.getCurrentlyAttachedDevicesInfo({},function(a){var e=[],t=[];l.map(a.attachedDevices,function(a){t.push(a.macAddress);var l=i.extend({enabled:!0},a);e.push(l)});for(var s=n.wifi_mac_black_list.split(";"),c=0;c<s.length;c++){var _=i.inArray(s[c],t);-1!=_&&(e[_].enabled=!1)}r.deviceInfo(e),i("#deviceInfo").translate()})}var n=e.getMacFilterInfo(),r=this;r.macFilterEnable=a.observable(n.ACL_mode),r.blackListEnabled=a.observable("2"==n.ACL_mode),r.blackList=a.observable(s(n.wifi_hostname_black_list,n.wifi_mac_black_list)),r.deviceInfo=a.observable([]),c(),addInterval(function(){c()},3e3),r.setMacFilter=function(){var a="",e="";l.map(r.blackList(),function(i){e=""==e?i.hostName:e+";"+i.hostName,a=""==a?i.macAddress:a+";"+i.macAddress}),t({ACL_mode:r.macFilterEnable(),wifi_hostname_black_list:e,wifi_mac_black_list:a})},addToBlackList=function(a,e,i,l){if(n.user_ip_addr==i)return showAlert("black_yourself_tip"),!1;if(r.blackList().length>=32)return showAlert("black_list_max"),!1;var s=""==n.wifi_hostname_black_list?a:a+";"+n.wifi_hostname_black_list,c=""==n.wifi_mac_black_list?e:e+";"+n.wifi_mac_black_list;t({ACL_mode:r.macFilterEnable(),wifi_hostname_black_list:s,wifi_mac_black_list:c},l)},removeFromBlackList=function(a){var e="",i="",s=r.blackList();s.splice(parseInt(a,10),1),l.map(s,function(a){e=""==e?a.hostName:e+";"+a.hostName,i=""==i?a.macAddress:i+";"+a.macAddress}),t({ACL_mode:r.macFilterEnable(),wifi_hostname_black_list:e,wifi_mac_black_list:i})}}function c(){var e=i("#container");a.cleanNode(e[0]);var t=new s;a.applyBindings(t,e[0]),i("#macFilterForm").validate({submitHandler:function(){t.setMacFilter()}})}return{init:c}});
//# sourceMappingURL=../../sourcemaps/wifi/mac_filter.js.map
