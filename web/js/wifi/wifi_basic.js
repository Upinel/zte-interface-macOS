define(["jquery","knockout","config/config","service","underscore"],function(e,s,i,a,o){function t(e){for(var s=[],i=1;i<=e;i++)s.push(new Option(i,i));return s}function n(){function o(){var e=a.getStatusInfo();"0"==e.radio_off||"1"==e.radio_off?(successOverlay(),clearTimer(),clearValidateMsg(),_()):u<=20?(u+=1,addTimeout(function(){o()},2e3)):(successOverlay(),clearTimer(),clearValidateMsg(),_())}function n(e){if(d.supportQrCode()){var s=(new Date).getTime();return e?"./img/qrcode_ssid_wifikey.png?_="+s:i.HAS_MULTI_SSID?"./img/qrcode_multi_ssid_wifikey.png?_="+s:"./img/menu_normal1.png"}return"./img/menu_normal1.png"}var d=this,m=r();d.wifi_ap_mode_set=s.observable(),d.hasWifiSwitch=i.WIFI_SWITCH_SUPPORT,d.showIsolated=i.SHOW_WIFI_AP_ISOLATED,d.wifi_enable=s.observable(m.wifi_enable),d.wifi_syncParas=s.observable(m.wifi_syncparas_flag),d.isShowSSIDInfoDiv=s.observable(!1),i.WIFI_SWITCH_SUPPORT?"1"==m.wifi_enable?(d.isShowSSIDInfoDiv(!0),"1"==m.m_band_enable&&"apap"==m.wifi_sta_switch_onoff?d.wifi_ap_mode_set("3"):"a"==m.wifiband?d.wifi_ap_mode_set("2"):d.wifi_ap_mode_set("1")):(d.wifi_ap_mode_set("0"),d.isShowSSIDInfoDiv(!1)):d.isShowSSIDInfoDiv(!0),d.hasMultiSSID=i.HAS_MULTI_SSID,d.multi_ssid_enable=s.observable(m.multi_ssid_enable),d.origin_multi_ssid_enable=m.multi_ssid_enable,d.supportQrCode=s.observable(i.WIFI_SUPPORT_QR_CODE),d.apStationSupport=i.AP_STATION_SUPPORT,d.maxStationNumber=s.computed(function(){return i.MAX_STATION_NUMBER});var f="OPEN"==m.AuthMode,S="OPEN"==m.m_AuthMode;d.modes=s.observableArray(h),d.selectedMode=s.observable(m.AuthMode),d.passPhrase=s.observable(m.passPhrase),d.showPassword=s.observable(!1),d.ssid=s.observable(m.SSID),d.broadcast=s.observable("1"==m.broadcast?"1":"0"),d.apIsolation=s.observable("1"==m.apIsolation?"1":"0"),d.cipher=m.cipher,d.selectedStation=s.observable(m.MAX_Access_num),d.maxStations=s.observableArray(t(m.MAX_Station_num)),d.m_modes=s.observableArray(h),d.m_selectedMode=s.observable(m.m_AuthMode),d.m_passPhrase=s.observable(m.m_passPhrase),d.m_showPassword=s.observable(!1),d.m_ssid=s.observable(m.m_SSID),d.m_broadcast=s.observable("1"==m.m_broadcast?"1":"0"),d.m_apIsolation=s.observable("1"==m.m_apIsolation?"1":"0"),d.m_cipher=m.m_cipher,d.m_selectedStation=s.observable(m.m_MAX_Access_num),d.m_maxStations=s.observableArray(t(m.MAX_Station_num)),d.qrcode_ssid1=s.observable(n(!0)),d.qrcode_ssid2=s.observable(n(!1)),d.showQrCode=s.observable(!0),d.m_showQrCode=s.observable(!0),d.securityModeChangeHandler=function(){f&&d.passPhrase(""),f="OPEN"==d.selectedMode()},d.mSecurityModeChangeHandler=function(){S&&d.m_passPhrase(""),S="OPEN"==d.m_selectedMode()},d.clear=function(e){"switch"==e?d.multi_ssid_enable(m.multi_ssid_enable):"ssid1"==e?(d.selectedMode(m.AuthMode),d.passPhrase(m.passPhrase),d.ssid(m.SSID),d.broadcast("1"==m.broadcast?"1":"0"),d.apIsolation("1"==m.apIsolation?"1":"0"),d.cipher=m.cipher,d.selectedStation(m.MAX_Access_num)):"ssid2"==e?(d.m_selectedMode(m.m_AuthMode),d.m_passPhrase(m.m_passPhrase),d.m_ssid(m.m_SSID),d.m_broadcast("1"==m.m_broadcast?"1":"0"),d.m_apIsolation("1"==m.m_apIsolation?"1":"0"),d.m_cipher=m.m_cipher,d.m_selectedStation(m.m_MAX_Access_num)):(clearTimer(),clearValidateMsg(),_())},d.checkSettings=function(s){var i=c();if("0"==i.radioFlag&&"switch"!=s)return showAlert("wps_wifi_off"),!0;if("1"==i.wpsFlag)return showAlert("wps_on_info"),!0;var o=a.getCurrentlyAttachedDevicesInfo(),t=[];if(e.each(o.attachedDevices,function(e,s){"1"==s.ssid_index&&t.push(s)}),t.length>d.selectedStation())return showAlert("can_not_modify_less_attached"),!0;if("switch"==s){var n=a.getStatusInfo();if(n.connectWifiSSID&&("connecting"==n.connectWifiStatus||"connect"==n.connectWifiStatus))return showAlert("cannot_operate_when_wifi_connected"),!0}return!1},d.saveSSIDsync=function(){d.checkSettings("ssid1")||showConfirm("wifi_disconnect_confirm",function(){d.saveSSIDsyncAction()})},d.saveSSIDsyncAction=function(){showLoading(),u=0;var s={};s.AuthMode=d.selectedMode(),s.passPhrase=d.passPhrase(),s.SSID=d.ssid(),d.broadcast(e("#broadcastCheckbox:checked").length>0?"0":"1"),d.apIsolation(e("#apisolatedCheckbox:checked").length),s.broadcast=d.broadcast(),s.station=d.selectedStation(),s.cipher="WPA2PSK"==d.selectedMode()?1:2,s.NoForwarding=d.apIsolation(),s.m_AuthMode=d.selectedMode(),s.m_passPhrase=d.passPhrase(),s.m_SSID=d.m_ssid(),d.m_broadcast(e("#broadcastCheckbox:checked").length>0?"0":"1"),d.m_apIsolation(e("#apisolatedCheckbox:checked").length),s.m_broadcast=d.broadcast(),s.m_station=d.selectedStation(),s.m_cipher="WPA2PSK"==d.selectedMode()?1:2,s.m_NoForwarding=d.apIsolation(),s.wifi_syncparas_flag=d.wifi_syncParas(),a.setWifiBasicSync(s,function(e){"success"==e.result?setTimeout(function(){l?(successOverlay(),setTimeout(function(){window.location.reload()},1e3)):setTimeout(function(){o()},2e3),d.clear(),d.qrcode_ssid1(n(!0)),d.qrcode_ssid2(n(!1))},l?15e3:0):(errorOverlay(),d.qrcode_ssid1(n(!0)),d.qrcode_ssid2(n(!1)))})},d.saveSSID1=function(){d.checkSettings("ssid1")||showConfirm("wifi_disconnect_confirm",function(){d.saveSSID1Action()})},d.saveSSID1Action=function(){showLoading(),u=0;var s={};s.AuthMode=d.selectedMode(),s.passPhrase=d.passPhrase(),s.SSID=d.ssid(),d.broadcast(e("#broadcastCheckbox:checked").length>0?"0":"1"),d.apIsolation(e("#apisolatedCheckbox:checked").length),s.broadcast=d.broadcast(),s.station=d.selectedStation(),s.cipher="WPA2PSK"==d.selectedMode()?1:2,s.NoForwarding=d.apIsolation(),a.setWifiBasic(s,function(e){"success"==e.result?setTimeout(function(){l?(successOverlay(),setTimeout(function(){window.location.reload()},1e3)):setTimeout(function(){o()},2e3),d.clear(),d.qrcode_ssid1(n(!0))},l?15e3:0):(errorOverlay(),d.qrcode_ssid1(n(!0)))})},d.saveSSID2=function(){d.checkSettings("ssid2")||showConfirm("wifi_disconnect_confirm",function(){d.saveSSID2Action()})},d.saveSSID2Action=function(){showLoading(),u=0;var s={};s.m_AuthMode=d.m_selectedMode(),s.m_passPhrase=d.m_passPhrase(),s.m_SSID=d.m_ssid(),d.m_broadcast(e("#m_broadcastCheckbox:checked").length>0?"0":"1"),d.m_apIsolation(e("#m_apisolatedCheckbox:checked").length),s.m_broadcast=d.m_broadcast(),s.m_station=d.m_selectedStation(),s.m_cipher="WPA2PSK"==d.m_selectedMode()?1:2,s.m_NoForwarding=d.m_apIsolation(),a.setWifiBasic4SSID2(s,function(e){"success"==e.result?setTimeout(function(){l?(successOverlay(),setTimeout(function(){window.location.reload()},1e3)):setTimeout(function(){o()},2e3),d.clear(),d.qrcode_ssid2(n(!1))},l?15e3:0):(errorOverlay(),d.qrcode_ssid2(n(!1)))})},d.setMultiSSIDSwitch=function(){if(!d.checkSettings("switch")){var e=function(){showLoading(),u=0;var e={};e.wifi_ap_mode_set=d.wifi_ap_mode_set(),a.setWifiFrequency(e,function(e){"success"==e.result?setTimeout(function(){l?(successOverlay(),setTimeout(function(){window.location.reload()},1e3)):setTimeout(function(){o()},3e3),d.clear(),d.qrcode_ssid1(n(!0)),d.qrcode_ssid2(n(!1))},l?15e3:0):(errorOverlay(),d.qrcode_ssid1(n(!0)),d.qrcode_ssid2(n(!1)))})};"1"==d.multi_ssid_enable()&&i.AP_STATION_SUPPORT?showConfirm("multi_ssid_enable_confirm",function(){e()}):e()}},d.syncParasHandler=function(){var s=e("#syncParas:checked");s&&0==s.length?(d.wifi_syncParas("1"),e("#frmSSID2 :input").each(function(){e(this).prop("disabled",!0)}),disableCheckbox(e(".checkboxToggle")),d.m_ssid(d.ssid()+"_5G"),e("#ssid").attr("maxlength","29")):(d.wifi_syncParas("0"),e("#frmSSID2 :input").each(function(){e(this).prop("disabled",!1)}),enableCheckbox(e(".checkboxToggle")),d.m_ssid(m.m_SSID),e("#ssid").attr("maxlength","32"))},d.syncParasHandler(),e("#ssid").unbind("keyup").bind("keyup",function(s){"1"==d.wifi_syncParas()?d.m_ssid(e("#ssid").val()+"_5G"):d.m_ssid(m.m_SSID)}),d.showPasswordHandler=function(){e("#passShow").parent().find(".error").hide();var s=e("#showPassword:checked");s&&0==s.length?d.showPassword(!0):d.showPassword(!1)},d.m_showPasswordHandler=function(){if("0"==d.wifi_syncParas()){e("#m_passShow").parent().find(".error").hide();var s=e("#m_showPassword:checked");s&&0==s.length?d.m_showPassword(!0):d.m_showPassword(!1)}},d.showQrCodeHandler=function(){e("#showQrCode").parent().find(".error").hide();var s=e("#showQrCode:checked");s&&0==s.length?d.showQrCode(!0):d.showQrCode(!1)},d.m_showQrCodeHandler=function(){e("#m_showQrCode").parent().find(".error").hide();var s=e("#m_showQrCode:checked");s&&0==s.length?d.m_showQrCode(!0):d.m_showQrCode(!1)}}function r(){return a.getWifiBasic()}function c(){return a.getWpsInfo()}function d(){a.getParams({nv:"user_ip_addr"},function(e){a.getParams({nv:"station_list"},function(s){l=isWifiConnected(e.user_ip_addr,s.station_list)})})}function _(){var o=e("#container");s.cleanNode(o[0]);var t=new n;s.applyBindings(t,o[0]),addTimeout(function(){d()},600),i.AP_STATION_SUPPORT&&function(){"1"==a.getAPStationBasic().ap_station_enable?(e("#frmWifiSwitch :input").each(function(){e(this).attr("disabled",!0)}),e("#frmMultiSSID :input").each(function(){e(this).attr("disabled",!0)})):(e("#frmWifiSwitch :input").each(function(){e(this).attr("disabled",!1)}),e("#frmMultiSSID :input").each(function(){e(this).attr("disabled",!1)}))}(),e("#frmMultiSSID").validate({submitHandler:function(){t.setMultiSSIDSwitch()}}),e("#frmWifiSwitch").validate({submitHandler:function(){t.setMultiSSIDSwitch()}}),e("#frmSSID1").validate({submitHandler:function(){"1"==t.wifi_syncParas()?t.saveSSIDsync():t.saveSSID1()},rules:{ssid:"ssid",pass:"wifi_password_check",passShow:"wifi_password_check"},errorPlacement:function(e,s){var i=s.attr("id");"pass"==i||"passShow"==i?e.insertAfter("#passShow"):e.insertAfter(s)}}),e("#frmSSID2").validate({submitHandler:function(){t.saveSSID2()},rules:{m_ssid:"ssid",m_pass:"wifi_password_check",m_passShow:"wifi_password_check"},errorPlacement:function(e,s){var i=s.attr("id");"m_pass"==i||"m_passShow"==i?e.insertAfter("#m_passShow"):e.insertAfter(s)}})}var l=!1,u=0,h=o.map(i.AUTH_MODES,function(e){return new Option(e.name,e.value)});return{init:_}});
//# sourceMappingURL=../../sourcemaps/wifi/wifi_basic.js.map
