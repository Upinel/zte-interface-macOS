define(["jquery","knockout","config/config","service","underscore"],function(e,t,n,s,a){function o(e){for(var n=[],s=[],a=0;a<e.length;a++)for(var o=0;o<e[a].length;o++)-1==t.utils.arrayIndexOf(n,e[a][o])&&(n.push(e[a][o]),s.push({index:e[a][o],rate:g[e[a][o]]}));return s.sort(function(e,t){return e.rate-t.rate}),s}function i(e){var t=[],n=[0,1,2,3,7],s=[0,4,6,8,10,12,14,16,18],a=[0,5,9,11,13,15,17,19,20];switch(e){case"0":t.push(n);break;case"1":t.push(s);break;case"2":t.push(a);break;case"3":t.push(n),t.push(s);break;case"4":t.push(n),t.push(s),t.push(a);break;default:t.push(a)}return r(o(t))}function r(e){for(var t=[],n=0;n<e.length;n++){var s=0==e[n].rate?"Auto":e[n].rate+" Mbps";t.push(new Option(s,e[n].index))}return t}function c(e){var t=[new Option("Auto","0")];switch(S(e)+""){case"1":l(t,2407,11);break;case"3":l(t,2407,11),l(t,2462,2);break;case"7":l(t,2307,13),l(t,2407,11),l(t,2462,2);break;default:l(t,2407,11)}return t}function d(t){for(key in n.countryCode_5g){var s=n.countryCode_5g[key];if(-1!=e.inArray(t,s.codes))return u(s.channels)}return[new Option("Auto","0")]}function l(e,t,n){for(var s=1;s<=n;s++){var a=t+5*s+"MHz (Channel "+e.length+")";e.push(new Option(a,e.length+"_"+(t+5*s)))}}function u(e){for(var t=[new Option("Auto","0")],n=0;n<e.length;n++){var s=e[n],a=5e3+5*s,o=a+"MHz (Channel "+s+")";t.push(new Option(o,s+"_"+a))}return t}function h(){var e=[];return e.push(new Option("5GHz","a")),e}function f(e){var t=[];return"2"==e?(t.push(new Option("20MHz","0")),t.push(new Option("20MHz/40MHz","1"))):"3"==e?(t.push(new Option("20MHz","0")),t.push(new Option("20MHz/40MHz","1")),t.push(new Option("20MHz/40MHz/80MHz","4"))):t.push(new Option("20MHz","0")),t}function S(t){var s=n.countryCode,a="";for(key in s){var o=s[key];if(-1!=e.inArray(t,o)){a=key;break}}var i=n.countryCodeType[a];return i||"0"}function _(e){var t=e?n.countries_5g:n.countries,s=[];for(key in t)s.push(new Option(t[key],key));return s=a.sortBy(s,function(e){return e.text})}function p(t){var s="a"==t?n.NETWORK_MODES_BAND:n.NETWORK_MODES;1==s.length?(e("#mode").hide(),e("#modeFor5HZ").hide()):"a"==t?(e("#modeFor5HZ").show(),e("#mode").hide(),e("#modeLabel").attr("for","modeFor5HZ")):(e("#mode").show(),e("#modeFor5HZ").hide());for(var a=[],o=0;o<s.length;o++)a.push(new Option(s[o].name,s[o].value));return a}function w(e,t){for(var n=0;n<t.length;n++){var s=t[n];if(s.text==e+" Mbps")return s.value}return"0"}function b(t,n){for(var s=0;s<n.length;s++){var a=e(n[s]);if(a.val().split("_")[0]==t)return a.val()}return"0"}function I(e){for(var t=[],n=1;n<=e;n++)t.push(new Option(n,n));return t}function v(){var a=this,o=A();a.hasWifiSwitch=n.WIFI_SWITCH_SUPPORT,a.hasGuestSSIDControl=n.WIFI_GUEST_SSID_ACCESS_SUPPORT,a.hasQRImg=n.WIFI_SUPPORT_QR_CODE,a.hasWifiMacFilter=n.WIFI_MAC_FILTER_SUPPORT,a.hasWifiDoubleChip=n.WIFI_DOUBLE_CHIP,a.hasMultiSSID=n.HAS_MULTI_SSID,a.showIsolated=n.SHOW_WIFI_AP_ISOLATED,a.wifi_enable=t.observable(o.wifiSwitch),a.accessPointEnable=t.observable(o.AccessPointSwitchStatus),a.originAccessPointEnable=t.observable(o.AccessPointSwitchStatus),a.isShowSSIDInfoDiv=t.observable(!1);var r=s.getParams({nv:"lan_sec_ssid_control"}).lan_sec_ssid_control;a.lan_sec_ssid_control=t.observable(r),n.WIFI_SWITCH_SUPPORT?"0"!=o.wifiSwitch?a.isShowSSIDInfoDiv(!0):a.isShowSSIDInfoDiv(!1):a.isShowSSIDInfoDiv(!0),a.origin_main_ssid_enable=o.wifiSwitch;var l="OPEN"==o.AuthMode;a.securityModeChangeHandler=function(){l&&(a.passPhrase(""),clearValidateMsg("#passwordContainer")),l="OPEN"==a.selectedSecurityMode()},a.maxStationNumber=t.computed(function(){return n.MAX_STATION_NUMBER}),a.securityModes=t.observableArray(O),a.selectedSecurityMode=t.observable(o.AuthMode),a.passPhrase=t.observable(o.Password),a.showPassword=t.observable(!1),a.ssid=t.observable(o.SSID),a.broadcast=t.observable("1"==o.ApBroadcastDisabled?"1":"0"),a.apIsolation=t.observable("1"==o.ApIsolate?"1":"0"),a.cipher=o.cipher,a.selectedStation=t.observable(o.ApMaxStationNumber),a.maxStations=t.observableArray(I(n.MAX_STATION_NUMBER)),a.showQrCode=t.observable(!("0"==o.QrImageShow)),a.qrcode_ssid1=t.observable(function(e){var t=(new Date).getTime();return e.QrImageUrl?e.QrImageUrl+"?_="+t:""}(o)),a.showQrCodeHandler=function(){e("#showQrCode").parent().find(".error").hide();var t=e("#showQrCode:checked");t&&0==t.length?a.showQrCode(!0):a.showQrCode(!1)},a.clear=function(e){"switch"==e?a.wifi_enable(o.wifiSwitch):"ssid1"==e?(a.selectedMode(o.AuthMode),a.passPhrase(o.Password),a.ssid(o.SSID),a.broadcast("1"==o.ApBroadcastDisabled?"1":"0"),a.cipher=o.cipher,a.selectedStation(o.ApMaxStationNumber),a.apIsolation("1"==o.ApIsolate?"1":"0")):"ssid2"==e?(a.m_selectedMode(o.AuthMode),a.m_passPhrase(o.Password),a.m_ssid(o.SSID),a.m_broadcast("1"==o.ApBroadcastDisabled?"1":"0"),a.m_cipher=o.cipher,a.m_selectedStation(o.ApMaxStationNumber),a.m_apIsolation("1"==o.ApIsolate?"1":"0")):(clearTimer(),clearValidateMsg(),P())},a.checkSettings=function(e){var t=m(),i=s.getStatusInfo();return"ssid1"==e&&"0"==a.accessPointEnable()&&"0"==o.AccessPointSwitchStatus_1_1?(showAlert("can_not_close_last_ssid"),!0):"ssid1"==e&&parseInt(a.selectedStation())<parseInt(i.station_num_ssid2)?(showAlert("can_not_modify_less_attached"),!0):"switch"!=e||"1"!=t.WpsStatus_1&&"1"!=t.WpsStatus_2?"ssid1"==e&&"1"==t.WpsStatus_2?(showAlert("wps_on_info"),!0):!(!n.HAS_MULTI_SSID||"1"!=o.AccessPointSwitchStatus_2_1||"1"!=o.AccessPointSwitchStatus_2_2||!("ssid1"==e&&parseInt(a.selectedStation())+parseInt(o.ApMaxStationNumber_2_2)>n.MAX_STATION_NUMBER||"ssid2"==e&&parseInt(a.m_selectedStation())+parseInt(o.MAX_Access_num)>n.MAX_STATION_NUMBER))&&(showAlert({msg:"multi_ssid_max_access_number_alert",params:n.MAX_STATION_NUMBER}),!0):(showAlert("wps_on_info"),!0)},a.saveSSID1=function(){a.checkSettings("ssid1")||showConfirm("wifi_disconnect_confirm",function(){a.saveSSID1Action()})},a.saveSSID1Action=function(){showLoading(),a.broadcast(e("#broadcastCheckbox:checked").length>0?"0":"1"),a.apIsolation(e("#apisolatedCheckbox:checked").length);var t={};t.ChipIndex="1",t.AccessPointIndex="0",t.AccessPointSwitchStatus=a.accessPointEnable(),t.originAccessPointSwitchStatus=a.originAccessPointEnable(),t.AuthMode=a.selectedSecurityMode(),t.Password=a.passPhrase(),t.SSID=a.ssid(),t.ApMaxStationNumber=a.selectedStation(),t.ApIsolate=a.apIsolation(),t.ApBroadcastDisabled=a.broadcast(),t.QrImageShow=a.showQrCode()?"1":"0",t.cipher="WPA2PSK"==a.selectedSecurityMode()?"CCMP":"TKIPCCMP",s.setWifiAccessPointInfo(t,function(e){"success"==e.result?a.checkWifiStatus():errorOverlay()})},a.showPasswordHandler=function(){e("#passShow").parent().find(".error").hide();var t=e("#showPassword:checked");t&&0==t.length?a.showPassword(!0):a.showPassword(!1)};var u=o;a.modes=t.observableArray(p(u.Band)),a.bands=t.observableArray(h());var S=_("a"==u.Band);a.countries=t.observableArray(S),a.channels=t.observableArray(d(u.CountryCode)),a.rates=t.observableArray(i(u.WirelessMode)),a.hasWifiBand=t.observable(n.WIFI_BAND_SUPPORT),a.hasBandwidth=t.observable(n.WIFI_BANDWIDTH_SUPPORT),a.selectedBand=t.observable(u.Band),a.selectedChannelBandwidth=t.observable(u.BandWidth),a.selectedMode=t.observable(u.WirelessMode),a.selectedCountry=t.observable(u.CountryCode.toUpperCase()),a.selectedChannel=t.observable(b(u.Channel,a.channels())),a.selectedRate=t.observable(w(u.rate,a.rates())),a.oneBandTrans=t.observable("a"==u.Band?"5G":"2.4G"),a.oneModeTrans=t.observable(("a"==u.Band?"network_modes_band_select_":"network_mode_select_")+u.WirelessMode),a.channelBandwidths=t.computed(function(){return f("2"==a.selectedMode()||"4"==a.selectedMode()?"2":"6"==a.selectedMode()||"8"==a.selectedMode()?"3":"1")}),a.bandChangeHandler=function(){"a"==a.selectedBand()?(a.modes(p(a.selectedBand())),a.countries(_(!0))):(a.modes(p(a.selectedBand())),a.countries(_(!1))),a.selectedCountry("0"),a.channels(a.generateChannelOption()),a.selectedChannel("0")},a.modeChangeHandler=function(e,t){var n=i(a.selectedMode());a.rates(n),a.selectedRate("0")},a.countryChangeHandler=function(e,t){var n=a.generateChannelOption();a.channels(n),a.selectedChannel("0")},a.generateChannelOption=function(){return"a"==a.selectedBand()?d(a.selectedCountry()):c(a.selectedCountry())},a.save=function(){if("1"==m().WpsStatus_2)return void showAlert("wps_on_info");var t=e("#rate option:selected").text(),o=null;o=t==e.i18n.prop("rate_0")?0:e.trim(t.replace("Mbps",""));var i={};i.ChipIndex="1",i.WirelessMode=a.selectedMode(),i.CountryCode=a.selectedCountry();var r=a.selectedChannel();i.Channel="0"==r?"0":r.split("_")[0],i.rate=o,i.Band=a.selectedBand(),n.WIFI_BANDWIDTH_SUPPORT&&(i.BandWidth=a.selectedChannelBandwidth()),showConfirm("wifi_disconnect_confirm",function(){showLoading(),s.setWifiChipAdvanceInfo(i,function(e){"success"==e.result?setTimeout(function(){successOverlay(),C&&setTimeout(function(){window.location.reload()},1e3)},C?15e3:0):errorOverlay()})})},a.setMultiSSIDSwitch=function(){if(!a.checkSettings("switch")){var t=function(){showLoading();var t={};n.WIFI_SWITCH_SUPPORT&&(t.SwitchOption=a.wifi_enable(),a.lan_sec_ssid_control(e("#allowAccessCheckbox:checked").length>0?"0":"1"),t.lan_sec_ssid_control=a.lan_sec_ssid_control()),s.setWifiModuleSwitchStatus(t,function(e){"success"==e.result?a.checkWifiStatus():errorOverlay()})};"0"==a.wifi_enable()?showConfirm("wifi_off_alert",function(){t()}):t()}},a.checkWifiStatus=function(){function e(){var t=s.getWifiModuleSwitchStatus();"0"!=t.WiFiModuleSwitch&&"1"!=t.WiFiModuleSwitch?addTimeout(e,1e3):setTimeout(function(){successOverlay(),C&&setTimeout(function(){window.location.reload()},1e3),"1"==a.accessPointEnable()?a.originAccessPointEnable("1"):a.originAccessPointEnable("0"),clearTimer(),clearValidateMsg(),P()},C?15e3:0)}setTimeout(function(){e()},2e3)}}function A(){var e=s.getWifiModuleSwitchStatus(),t=s.getWifiAccessPointInfo();return wifiFilterAPInfo(e,t,n.WIFICHIPINDEX.SECOND,n.ACCESSPOINTINDEX.FIRST,n.WIFICHIPINDEX,n.ACCESSPOINTINDEX)}function m(){var e=s.getWifiWpsStatus();return wifiWPSActiveInfo(e)}function M(){s.getParams({nv:"user_ip_addr"},function(e){s.getParams({nv:"station_list"},function(t){C=isWifiConnected(e.user_ip_addr,t.station_list)})})}function P(){var a=e("#container");t.cleanNode(a[0]);var o=new v;t.applyBindings(o,a[0]),addTimeout(function(){M()},600),n.AP_STATION_SUPPORT?function(){"1"==s.getAPStationBasic().ap_station_enable?e("#frmMultiSSID :input").each(function(){e(this).prop("disabled",!0)}):e("#frmMultiSSID :input").each(function(){e(this).prop("disabled",!1)})}():n.WDS_SUPPORT&&function(){"0"!=s.getWdsInfo().currentMode?(e("#frmWifiSwitch :input").each(function(){e(this).prop("disabled",!0)}),e("#frmSSID1 :input").each(function(){e(this).prop("disabled",!0)})):(e("#frmWifiSwitch :input").each(function(){e(this).prop("disabled",!1)}),e("#frmSSID1 :input").each(function(){e(this).prop("disabled",!1)}))}(),e("#frmWifiSwitch").validate({submitHandler:function(){o.setMultiSSIDSwitch()}}),e("#frmSSID1").validate({submitHandler:function(){o.saveSSID1()},rules:{ssid:"ssid",pass:"wifi_password_check",passShow:"wifi_password_check"},errorPlacement:function(e,t){var n=t.attr("id");"pass"==n||"passShow"==n?e.insertAfter("#lblShowPassword"):e.insertAfter(t)}}),e("#wifi_advance_form").validate({submitHandler:function(){o.save()}})}var C=!1,g=[0,1,2,5.5,6,6.5,9,11,12,13,18,19.5,24,26,36,39,48,52,54,58.5,65],O=a.map(n.AUTH_MODES,function(e){return new Option(e.name,e.value)});return{init:P}});
//# sourceMappingURL=../../sourcemaps/wifi/wifi_main_chip2.js.map
