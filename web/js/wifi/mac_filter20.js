define(["knockout","service","jquery","config/config","underscore"],function(i,t,e,s,a){function c(){function c(i,s){var a=e.extend({},i);t.setMacFilterStatus(a,function(i){"success"==i.result?(successOverlay(),l(m),m.clear(),e("#blacklist").translate(),e("#whitelist").translate(),e("#deviceInfo").translate(),e("#deviceInfoWhite").translate()):errorOverlay()})}function u(){"2"!=m.info.aclMode&&"1"!=m.info.aclMode||t.getCurrentlyAttachedDevicesInfo({},function(i){var t=[],s=[];a.map(i.attachedDevices,function(i){s.push(i.macAddress),i.hostName=o(i.hostName,i.macAddress,w);var a=e.extend({enabled:!0,enabledWhite:!0},i);t.push(a)});for(var c=m.info.wifiMacBlackList.split(";"),n=0;n<c.length;n++){var r=e.inArray(c[n],s);-1!=r&&(t[r].enabled=!1)}for(var l=m.info.wifiMacWhiteList.split(";"),n=0;n<l.length;n++){var r=e.inArray(l[n],s);-1!=r&&(t[r].enabledWhite=!1)}m.deviceInfo(t),e("#deviceInfo").translate(),e("#deviceInfoWhite").translate()})}function _(i,s){var a=L();if("1"==a.WpsStatus_1||"1"==a.WpsStatus_2)return showAlert("wps_on_info"),!1;e.extend({},i);t.setMacFilterStatus(i,function(i){"success"==i.result?(successOverlay(),l(m),m.clear(),e("#whitelist").translate()):errorOverlay()})}function L(){var i=t.getWifiWpsStatus();return wifiWPSActiveInfo(i)}var m=this;m.hasWifiSwitch=s.WIFI_SWITCH_SUPPORT,m.hasGuestSSIDControl=s.WIFI_GUEST_SSID_ACCESS_SUPPORT,m.hasWifiMacFilter=s.WIFI_MAC_FILTER_SUPPORT,m.hasWifiDoubleChip=s.WIFI_DOUBLE_CHIP,m.hasMultiSSID=s.HAS_MULTI_SSID,m.hasApStation=s.AP_STATION_SUPPORT,m.hasWIFI5G=s.WIFI_HAS_5G,m.isUfi=i.observable(-1!=s.DEVICE.toLowerCase().indexOf("ufi")),m.hasMacFilter=s.HAS_MAC_FILTER,w=t.getHostNameList({}).devices;var b=t.getMacFilterStatus(),S=t.getWifiModuleSwitchStatus();m.info=b;var v=r();m.accessPointEnable=i.observable(v.AccessPointSwitchStatus),m.originAccessPointEnable=i.observable(v.AccessPointSwitchStatus),m.origin_wifi_enable=v.wifiSwitch,m.wifi_enable=i.observable(v.wifiSwitch);var M=t.getParams({nv:"lan_sec_ssid_control"}).lan_sec_ssid_control;m.lan_sec_ssid_control=i.observable(M),m.wifi_enable_click=function(){"1"==m.wifi_enable()?m.wifi_enable("0"):m.wifi_enable("1")},m.isShowSSIDInfoDiv=i.observable(!1),s.WIFI_SWITCH_SUPPORT?"0"!=S.WiFiModuleSwitch?m.isShowSSIDInfoDiv(!0):m.isShowSSIDInfoDiv(!1):m.isShowSSIDInfoDiv(!0),m.origin_main_ssid_enable=S.WiFiModuleSwitch,m.ssid_chip1_enable=i.observable(!1),"1"==S.WiFiModuleSwitch&&"1"==v.AccessPointSwitchStatus_1_1?m.ssid_chip1_enable(!0):m.ssid_chip1_enable(!1),m.ssid_chip2_enable=i.observable(!1),"1"==S.WiFiModuleSwitch&&"1"==v.AccessPointSwitchStatus_2_1?m.ssid_chip2_enable(!0):m.ssid_chip2_enable(!1),m.setWifiSwitch=function(){if(!m.checkSettings("switch")){!function(){showLoading();var i={};s.WIFI_SWITCH_SUPPORT&&(i.SwitchOption=m.wifi_enable(),m.lan_sec_ssid_control(e("#allowAccessCheckbox:checked").length>0?"0":"1"),i.lan_sec_ssid_control=m.lan_sec_ssid_control()),t.setWifiModuleSwitchStatus(i,function(i){"success"==i.result?m.checkWifiStatus():errorOverlay()})}()}},m.checkWifiStatus=function(){function i(){var e=t.getWifiModuleSwitchStatus();"0"!=e.WiFiModuleSwitch&&"1"!=e.WiFiModuleSwitch?addTimeout(i,1e3):setTimeout(function(){successOverlay(),f&&setTimeout(function(){window.location.reload()},1e3),"1"==m.accessPointEnable()?m.originAccessPointEnable("1"):m.originAccessPointEnable("0"),clearTimer(),clearValidateMsg(),l()},f?15e3:0)}setTimeout(function(){i()},2e3)},m.macFilterEnable=i.observable(b.aclMode),m.macFilterEnableOri=i.observable(b.aclMode),m.blackList=i.observable(n(b.wifiHostnameBlackList,b.wifiMacBlackList)),m.whiteList=i.observable(n(b.wifiHostnameWhiteList,b.wifiMacWhiteList)),m.blackListOri=i.observable(b.wifiMacBlackList),m.whiteListOri=i.observable(b.wifiMacWhiteList),m.blackListHostNameOri=i.observable(b.wifiHostnameBlackList),m.whiteListHostNameOri=i.observable(b.wifiHostnameWhiteList),m.deviceInfo=i.observable([]),m.newHostNameBlackList=i.observable(""),m.newMacAddressBlackList=i.observable(""),m.newMacAddressWhiteList=i.observable(""),m.setMacFilterSwitch=function(){var i=L();if("1"==i.WpsStatus_1||"1"==i.WpsStatus_2)return showAlert("wps_on_info"),!1;for(var s="",a="",n=m.whiteListOri().split(";"),r=0;r<m.deviceInfo().length;r++)-1==e.inArray(m.deviceInfo()[r].macAddress,n)&&(s=m.deviceInfo()[r].macAddress+";"+s,a=m.deviceInfo()[r].hostName+";"+a);if("1"!=m.macFilterEnable())var o={aclMode:m.macFilterEnable(),wifiMacBlackList:m.blackListOri(),wifiHostnameBlackList:m.blackListHostNameOri(),wifiMacWhiteList:m.whiteListOri(),wifiHostnameWhiteList:m.whiteListHostNameOri()};else var o={aclMode:m.macFilterEnable(),wifiMacBlackList:m.blackListOri(),wifiHostnameBlackList:m.blackListHostNameOri(),wifiMacWhiteList:""==s?m.whiteListOri():s+m.whiteListOri(),wifiHostnameWhiteList:""==a?m.whiteListHostNameOri():a+m.whiteListHostNameOri()};1==t.getAntiVioCraSetting().prevent_attack_enable&&2!=m.macFilterEnable()?showConfirm("anti_vio_ack_open_note",function(){c(o)}):c(o)},m.saveNewBlackList=function(){if(""!=m.blackListOri())for(var i=m.blackListOri().split(";"),t=0;t<i.length;t++)if(m.newMacAddressBlackList().toLowerCase()==i[t].toLowerCase())return showAlert("rule_exist"),!1;m.addToBlackListAct(m.newMacAddressBlackList(),"","")},m.addToBlackList=function(i){var t=i.ipAddress,e=i.macAddress,s=i.hostName;m.addToBlackListAct(e,t,s)},m.addToBlackListAct=function(i,e,s){var a=L();if("1"==a.WpsStatus_1||"1"==a.WpsStatus_2)return showAlert("wps_on_info"),!1;if(t.getParams({nv:"user_ip_addr"})==e)return showAlert("black_yourself_tip"),!1;if(m.blackList().length>=d)return showAlert("black_list_max"),!1;var n=""==m.blackListOri()?i+";":i+";"+m.blackListOri(),r=""==m.blackListOri()?s+";":s+";"+m.blackListHostNameOri();c({aclMode:m.macFilterEnable(),wifiMacBlackList:n,wifiHostnameBlackList:r,wifiMacWhiteList:m.whiteListOri(),wifiHostnameWhiteList:m.whiteListHostNameOri()})},m.removeFromBlackList=function(i){var t=i.index,e=L();if("1"==e.WpsStatus_1||"1"==e.WpsStatus_2)return showAlert("wps_on_info"),!1;var s="",n="",r=m.blackList(),o=m.blackListHostNameOri().split(";");r.splice(parseInt(t,10),1),a.map(r,function(i){s=""==s?i.macAddress+";":s+i.macAddress+";"});for(var l=0;l<o.length-1;l++)l!=t&&(n+=o[l]+";");c({aclMode:m.macFilterEnable(),wifiMacBlackList:s,wifiHostnameBlackList:n,wifiMacWhiteList:m.whiteListOri(),wifiHostnameWhiteList:m.whiteListHostNameOri()})},u(),addInterval(function(){u()},3e3),m.saveWhiteMAC=function(){var i=t.getMacFilterStatus();if(""!=i.wifiMacWhiteList)for(var e=i.wifiMacWhiteList.split(";"),s=0;s<e.length;s++)if(m.newMacAddressWhiteList().toLowerCase()==e[s].toLowerCase())return showAlert("rule_exist"),!1;addToWhiteList(m.newMacAddressWhiteList(),"","")},m.addToWhiteListFromDeviceInfoWhite=function(i){var t=(i.ipAddress,i.macAddress),e=i.hostName;_({aclMode:m.macFilterEnable(),wifiMacBlackList:m.blackListOri(),wifiHostnameBlackList:m.blackListHostNameOri(),wifiMacWhiteList:t+";"+m.whiteListOri(),wifiHostnameWhiteList:e+";"+m.whiteListHostNameOri()})},addToWhiteList=function(i,t,e){if(m.whiteList().length>=h)return showAlert("white_list_max"),!1;_({aclMode:m.macFilterEnable(),wifiMacBlackList:m.blackListOri(),wifiHostnameBlackList:m.blackListHostNameOri(),wifiMacWhiteList:m.newMacAddressWhiteList()+";"+m.whiteListOri(),wifiHostnameWhiteList:";"+m.whiteListHostNameOri()},e)},m.removeFromWhiteList=function(i){var s=i.macAddress;showLoading();var a={};a.aclMode=m.macFilterEnable(),a.wifiMacBlackList=m.blackListOri(),a.wifiHostnameBlackList=m.blackListHostNameOri();for(var c=m.whiteListOri().split(";"),n=m.whiteListHostNameOri().split(";"),r="",o="",f=0;f<c.length-1;f++)s!=c[f]&&(r+=c[f]+";",o+=n[f]+";");a.wifiMacWhiteList=r,a.wifiHostnameWhiteList=o,t.setMacFilterStatus(a,function(i){hideLoading(),"success"==i.result?(successOverlay(),l(m),m.clear(),e("#whitelist").translate()):errorOverlay()})},m.checkSettings=function(i){var e=L(),a=t.getStatusInfo();return"ssid1"==i&&"0"==m.accessPointEnable()&&"0"==b.AccessPointSwitchStatus_2_1?(showAlert("can_not_close_last_ssid"),!0):"ssid1"==i&&parseInt(m.selectedStation())<parseInt(a.station_num_ssid1)?(showAlert("can_not_modify_less_attached"),!0):"switch"!=i||"1"!=e.WpsStatus_1&&"1"!=e.WpsStatus_2?"ssid1"==i&&"1"==e.WpsStatus_1?(showAlert("wps_on_info"),!0):!(!s.HAS_MULTI_SSID||"1"!=b.AccessPointSwitchStatus_1_2||!("ssid1"==i&&parseInt(m.selectedStation())+parseInt(b.ApMaxStationNumber_1_2)>s.MAX_STATION_NUMBER||"ssid2"==i&&parseInt(m.m_selectedStation())+parseInt(b.MAX_Access_num)>s.MAX_STATION_NUMBER))&&(showAlert({msg:"multi_ssid_max_access_number_alert",params:s.MAX_STATION_NUMBER}),!0):(showAlert("wps_on_info"),!0)},m.clear=function(){}}function n(i,t){if(""==t)return[];for(var e=i.split(";"),s=t.split(";"),a=[],c=0;c<s.length-1;c++){var n={};n.hostName=o(e[c],s[c],w),n.macAddress=s[c],n.index=c,a.push(n)}return a}function r(){var i=t.getWifiModuleSwitchStatus(),e=t.getWifiAccessPointInfo();return wifiFilterAPInfo(i,e,s.WIFICHIPINDEX.FIRST,s.ACCESSPOINTINDEX.FIRST,s.WIFICHIPINDEX,s.ACCESSPOINTINDEX)}function o(i,t,e){var s=a.find(e,function(i){return i.mac==t});return s?s.hostname:i}function l(s){if(s){o=s;var a=t.getMacFilterStatus();return o.info=a,o.macFilterEnable(a.aclMode),o.macFilterEnableOri(a.aclMode),o.blackList(n(a.wifiHostnameBlackList,a.wifiMacBlackList)),o.whiteList(n(a.wifiHostnameWhiteList,a.wifiMacWhiteList)),o.blackListOri(a.wifiMacBlackList),o.whiteListOri(a.wifiMacWhiteList),o.blackListHostNameOri(a.wifiHostnameBlackList),o.whiteListHostNameOri(a.wifiHostnameWhiteList),o.newMacAddressBlackList(""),void o.newMacAddressWhiteList("")}var r=e("#container");i.cleanNode(r[0]);var o=new c;i.applyBindings(o,r[0]),e("#frmWifiSwitch").validate({submitHandler:function(){o.setWifiSwitch()}}),e("#macFilterForm").validate({submitHandler:function(){o.setMacFilterSwitch()}}),e("#setBlackListFrm").validate({submitHandler:function(){o.saveNewBlackList()},rules:{txtNewMacAddressBlackList:{mac_check:!0},txtNewHostNameBlackList:{device_rename:!0}},errorPlacement:function(i,t){"txtNewMacAddressBlackList"==t.attr("name")?i.insertAfter("#macExamLabel"):i.insertAfter(t)}}),e("#setWhiteListFrm").validate({submitHandler:function(){o.saveWhiteMAC()},rules:{texNewMacAddressWhiteList:{mac_check:!0}},errorPlacement:function(i,t){"txtMacAddress2"==t.attr("name")?i.insertAfter("#macExamLabel2"):i.insertAfter(t)}})}var f=!1,d=32,h=32,w="";return e.validator.addMethod("device_rename",function(i,t,e){return!(0==i.indexOf(" ")||i.lastIndexOf(" ")==i.length-1||/[\+;"\\]{1,32}/.test(i))}),{init:l}});
//# sourceMappingURL=../../sourcemaps/wifi/mac_filter20.js.map
