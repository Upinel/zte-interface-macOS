define(["jquery","knockout","config/config","service","underscore"],function(t,e,a,o,s){function n(){function a(){var e=o.getStatusInfo();if("PPPOE"==i.currentMode()||"AUTO_PPPOE"==i.currentMode()){i.isPppoeMode(!0),i.isStaticMode(!1),i.staticNoticeShow(!1),i.dhcpNoticeShow(!1),"ppp_connected"==n.ppp_status||"ppp_connecting"==n.ppp_status?i.enableFlag(!1):i.enableFlag(!0);var a="ppp_connected"==n.ppp_status?"disconnect":"connect";i.action(a),"auto_dial"==i.pppMode()?i.btnTrans("apply"):"ppp_connected"==n.ppp_status?i.btnTrans("disconnect"):i.btnTrans("connect"),"auto_dial"==i.pppMode()&&"ppp_connected"==n.ppp_status?t("input:submit").attr("disabled",!0):t("input:submit").attr("disabled",!1)}else"STATIC"==i.currentMode()?("PPPOE"==e.opms_wan_mode&&("ppp_connected"==n.ppp_status?t("input:submit").attr("disabled",!0):t("input:submit").attr("disabled",!1)),i.isStaticMode(!0),i.isPppoeMode(!1),i.btnTrans("apply"),i.dhcpNoticeShow(!1)):(("PPPOE"==e.opms_wan_mode||"AUTO"==e.opms_wan_mode&&"AUTO_PPPOE"==e.opms_wan_auto_mode)&&("ppp_connected"==n.ppp_status?t("input:submit").attr("disabled",!0):t("input:submit").attr("disabled",!1)),i.isStaticMode(!1),i.isPppoeMode(!1),i.btnTrans("apply"),i.staticNoticeShow(!1),("DHCP"==e.opms_wan_mode||"AUTO"==e.opms_wan_mode&&"AUTO_DHCP"==e.opms_wan_auto_mode)&&(i.dhcpNoticeShow(!0),"1"==e.dhcp_wan_status?i.dhcpNoticeText(t.i18n.prop("dyn_success")):i.dhcpNoticeText(t.i18n.prop("dyn_fail"))));t("#pppoeApply").translate()}var s=o.getOpMode(),n=o.getPppoeParams();setInterval(function(){var t=o.getStatusInfo();n.ppp_status=t.connectStatus},1e3);var i=this;if(i.modes=e.observableArray(_),"AUTO_PPPOE"==s.opms_wan_mode||"AUTO_DHCP"==s.opms_wan_mode?i.modes(u):i.modes(_),i.isPppoeMode=e.observable(!1),i.isStaticMode=e.observable(!1),i.action=e.observable(),i.btnTrans=e.observable(),i.enableFlag=e.observable(),i.currentMode=e.observable(s.opms_wan_mode),i.staticNoticeShow=e.observable(),i.dhcpNoticeShow=e.observable(),i.staticNotice=e.observable(),i.dhcpNotice=e.observable(),i.dhcpNoticeText=e.observable(),i.staticNoticeText=e.observable(),"DHCP"==i.currentMode()||"AUTO_DHCP"==i.currentMode())switch(n.dhcp_wan_status){case"0":i.dhcpNoticeShow(!0),i.dhcpNotice("dyn_fail"),i.dhcpNoticeText(t.i18n.prop("dyn_fail"));break;case"1":i.dhcpNoticeShow(!0),i.dhcpNotice("dyn_success"),i.dhcpNoticeText(t.i18n.prop("dyn_success"));break;default:i.dhcpNoticeShow(!1)}if("STATIC"==i.currentMode())switch(n.static_wan_status){case"0":i.staticNoticeShow(!0),i.staticNotice("static_fail"),i.staticNoticeText(t.i18n.prop("static_fail"));break;case"1":i.staticNoticeShow(!0),i.staticNotice("static_success"),i.staticNoticeText(t.i18n.prop("static_success"));break;default:i.staticNoticeShow(!1)}i.changeModeDiv=function(){a()},i.user=e.observable(n.pppoe_username),i.password=e.observable(n.pppoe_password),i.pppMode=e.observable(n.pppoe_dial_mode),a(),i.radioHandler=function(){return a(),!0},i.ipAddress=e.observable(n.static_wan_ipaddr),i.subnetMask=e.observable(n.static_wan_netmask),i.defaultGateway=e.observable(n.static_wan_gateway),i.primaryDNS=e.observable(n.static_wan_primary_dns),i.secondaryDNS=e.observable(n.static_wan_secondary_dns),addInterval(a,1e3),i.save=function(){function e(){t.getJSON("/goform/goform_get_cmd_process",{cmd:"dhcp_wan_status",_:(new Date).getTime()},function(a){c<1?(c++,setTimeout(e,3e3)):"1"==a.dhcp_wan_status?(p&&(p=!1,hideLoading()),"DHCP"!=i.currentMode()&&"AUTO_DHCP"!=i.currentMode()||(i.dhcpNoticeShow(!0),i.staticNoticeShow(!1),i.dhcpNotice("dyn_success"),i.dhcpNoticeText(t.i18n.prop("dyn_success")))):c>=2||"0"==a.dhcp_wan_status||""==a.dhcp_wan_status?(p&&(p=!1,hideLoading()),"DHCP"!=i.currentMode()&&"AUTO_DHCP"!=i.currentMode()||(i.dhcpNoticeShow(!0),i.staticNoticeShow(!1),i.dhcpNotice("dyn_fail"),i.dhcpNoticeText(t.i18n.prop("dyn_fail"))),setTimeout(e,3e3),c++):p&&(p=!1,hideLoading())}).error(function(){callback(!1)})}function a(){t.getJSON("/goform/goform_get_cmd_process",{cmd:"static_wan_status",_:(new Date).getTime()},function(e){r<1?(r++,setTimeout(a,3e3)):"0"==e.static_wan_status||""==e.static_wan_status?(hideLoading(),i.staticNoticeShow(!0),i.dhcpNoticeShow(!1),i.staticNotice("static_fail"),i.staticNoticeText(t.i18n.prop("static_fail"))):"1"==e.static_wan_status?(hideLoading(),i.staticNoticeShow(!0),i.dhcpNoticeShow(!1),i.staticNotice("static_success"),i.staticNoticeText(t.i18n.prop("static_success"))):hideLoading()}).error(function(){callback(!1)})}var s=o.getStatusInfo(),n={};if("PPPOE"==t("#pppoe_mode").val()||"AUTO_PPPOE"==t("#pppoe_mode").val())n=t.extend({},{goformId:"WAN_GATEWAYMODE_PPPOE",pppoe_username:i.user(),pppoe_password:i.password(),dial_mode:i.pppMode(),action_link:"PPPOE"!=s.opms_wan_mode&&"AUTO"!=s.opms_wan_mode||"ppp_connected"!=s.connectStatus?"connect":"disconnect"});else if("STATIC"==t("#pppoe_mode").val()){if(i.ipAddress()==i.defaultGateway())return void showAlert("ip_gate_not_same");n=t.extend({},{goformId:"WAN_GATEWAYMODE_STATIC",static_wan_ipaddr:i.ipAddress(),static_wan_netmask:i.subnetMask(),static_wan_gateway:i.defaultGateway(),static_wan_primary_dns:i.primaryDNS(),static_wan_secondary_dns:i.secondaryDNS(),WAN_MODE:"STATIC"})}else n=t.extend({},{goformId:"WAN_GATEWAYMODE_DHCP"});showLoading(),o.setPppoeDialMode(n,function(o){o.result?("WAN_GATEWAYMODE_DHCP"==n.goformId?e():"WAN_GATEWAYMODE_STATIC"==n.goformId?a():successOverlay(),t("#pppoeApply").translate()):"WAN_GATEWAYMODE_STATIC"==n.goformId?(i.staticNoticeShow(!0),i.dhcpNoticeShow(!1),i.staticNotice(t.i18n.prop("static_fail"))):"WAN_GATEWAYMODE_DHCP"==n.goformId?(i.dhcpNoticeShow(!0),i.staticNoticeShow(!1),i.dhcpNotice(t.i18n.prop("dyn_fail"))):errorOverlay()});var c=0,p=!0,r=0}}function i(){var a=t("#container");e.cleanNode(a[0]);var o=new n;e.applyBindings(o,a[0]),t("#pppoeApply").translate(),t("#pppoeForm").validate({submitHandler:function(){o.save()},rules:{txtPin:"wps_pin_check",txtIpAddress:"dmz_ip_check",pppoeUn:"ppp_username_check",pppoePw:"ppp_password_check",txtSubnetMask:{ipv4:!0,subnetmask_check:!0},txtDefaultGateway:{ipv4:!0,gateway_check:!0},txtPrimaryDNS:{ipv4:!0},txtSecondaryDNS:{ipv4:!0}}})}function c(t){var e=new Array;if(e=t.split("."),4!=e.length)return!1;if(e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),e[2]=parseInt(e[2]),e[3]=parseInt(e[3]),0!=e[3]){if(255!=e[2]||255!=e[1]||255!=e[0])return!1;if(!p(e[3]))return!1}if(0!=e[2]){if(255!=e[1]||255!=e[0])return!1;if(!p(e[2]))return!1}if(0!=e[1]){if(255!=e[0])return!1;if(!p(e[1]))return!1}return 255==e[0]&&("0.0.0.0"!=t&&"255.255.255.255"!=t)}function p(t){return 255==t||254==t||252==t||248==t||240==t||224==t||192==t||128==t||0==t}function r(t,e,a){return d(t,e)==d(e,a)}function d(t,e){for(var a=[],o=t.split("."),s=e.split("."),n=0;n<o.length;n++)a[n]=o[n]&s[n];return a.join(".")}var _=s.map(a.pppoeModes,function(t){return new Option(t.name,t.value)}),u=s.map(a.autoPPPOEModes,function(t){return new Option(t.name,t.value)});s.map(a.dialActions,function(t){return new Option(t.name,t.value)});return jQuery.validator.addMethod("subnetmask_check",function(t,e,a){var o=c(t);return this.optional(e)||o}),jQuery.validator.addMethod("gateway_check",function(e,a,o){var s=r(t("#txtIpAddress").val(),t("#txtSubnetMask").val(),t("#txtDefaultGateway").val());return this.optional(a)||s}),{init:i}});
//# sourceMappingURL=../../sourcemaps/network/dial_setting_cpe.js.map
