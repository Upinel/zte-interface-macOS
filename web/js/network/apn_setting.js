define(["jquery","knockout","config/config","service","underscore"],function(e,n,a,s,r){function o(){return r.map(a.APN_AUTH_MODES,function(e){return new Option(e.name,e.value)})}function t(){var e=[new Option("IPv4","IP")];return a.IPV6_SUPPORT&&(e.push(new Option("IPv6","IPv6")),a.IPV4V6_SUPPORT&&e.push(new Option("IPv4v6","IPv4v6")),a.IPV4_AND_V6_SUPPORT&&e.push(new Option("IPv4 & IPv6","IPv4v6"))),e}function p(){var e=s.getApnSettings();return e.ipv6ApnConfigs=d(e.ipv6APNs,!0),e.apnConfigs=d(e.APNs,!1),e.autoApnConfigs=i(e.autoApns,e.autoApnsV6),e}function d(e,n){var a=[],s={};if(e&&e.length>10)for(var r=e.split("||"),o=0;o<r.length;o++)if(""!=r[o]){var t=u(r[o],n);a.push(t),s[t.profileName]=t}return n?m=s:P=s,a}function i(e,n){var a=[],s=[];if(e&&e.length>5)for(var r=e.split("||"),o=0;o<r.length;o++)if(""!=r[o]){var t=u(r[o],!1);a.push(t)}if(n&&n.length>5)for(var r=n.split("||"),o=0;o<r.length;o++)if(""!=r[o]){var t=u(r[o],!1);s.push(t)}return l(a,s)}function l(e,n){A={};for(var a=[],s=0;s<e.length;s++){var r=e[s],o=n[s];!o||"IPv6"!=o.pdpType&&"IPv4v6"!=o.pdpType||(r.wanApnV6=o.wanApn,r.authModeV6=o.authMode,r.usernameV6=o.username,r.passwordV6=o.password,r.dnsModeV6=o.dnsMode,r.dns1V6=o.dns1,r.dns2V6=o.dns2),a.push(r),A[r.profileName]=r}return a}function u(e,n){for(var a={},s=e.split("($)"),r=0;r<s.length;r++)a.profileName=s[0],a.pdpType=s[7],n?(a.wanApnV6=s[1],a.authModeV6=s[4].toLowerCase(),a.usernameV6=s[5],a.passwordV6=s[6],a.dnsModeV6=s[10],a.dns1V6=s[11],a.dns2V6=s[12]):(a.wanApn=s[1],a.authMode=s[4].toLowerCase(),a.username=s[5],a.password=s[6],a.dnsMode=s[10],a.dns1=s[11],a.dns2=s[12]);return a}function f(e){return r.map(e,function(e){return new Option(e.profileName,e.profileName)})}function _(){function r(){a.IPV4V6_SUPPORT&&v.selectedPdpType();var n=0;"auto"==v.apnMode()?(n=i(),v.selectedAutoProfile(e("#autoProfile").val())):(n=d(),v.selectedProfile(e("#profile").val()));var r=v.getSelectedManualProfile();s.setDefaultApn({index:n,apnMode:v.apnMode(),pdpType:r.pdpType,profileName:r.profileName,wanApn:r.wanApn,authMode:r.authMode,username:r.username,password:r.password,dnsMode:a.SHOW_APN_DNS?r.dnsMode:"auto",dns1:a.SHOW_APN_DNS?r.dns1:"",dns2:a.SHOW_APN_DNS?r.dns2:""},function(e){e.result?addTimeout(function(){V(!0),v.apnModeChangeHandler(),successOverlay()},"auto"==v.apnMode()?5e3:500):errorOverlay()},function(e){errorOverlay()})}function d(){for(var n=e("#profile option"),a=0;a<n.length;a++)if(n[a].value==v.selectedProfile())return a;return n.length-1}function i(){for(var n=e("#autoProfile option"),a=0;a<n.length;a++)if(n[a].value==v.selectedAutoProfile())return a;return n.length-1}function l(){showLoading();var n=e("option","#profile").length;if(n<a.defaultApnSize)return void errorOverlay();var o=!1;a.IPV4V6_SUPPORT&&"IPv4v6"==v.selectedPdpType()&&(o=!0),s.addOrEditApn({profileName:v.profileName(),pdpType:v.selectedPdpType(),index:n,wanApn:v.apn(),authMode:v.selectedAuthentication(),username:v.username(),password:v.password(),dnsMode:a.SHOW_APN_DNS?v.dnsMode():"auto",dns1:a.SHOW_APN_DNS?v.dns1():"",dns2:a.SHOW_APN_DNS?v.dns2():"",wanApnV6:o?v.apn():v.apnV6(),authModeV6:o?v.selectedAuthentication():v.selectedAuthenticationV6(),usernameV6:o?v.username():v.usernameV6(),passwordV6:o?v.password():v.passwordV6(),dnsModeV6:a.SHOW_APN_DNS?o?v.dnsMode():v.dnsModeV6():"auto",dns1V6:a.SHOW_APN_DNS?o?v.dns1():v.dns1V6():"",dns2V6:a.SHOW_APN_DNS?o?v.dns2():v.dns2V6():""},function(n){if(n.result){if(h=p(),v.profileName()!=v.selectedProfile()){var a=v.profileName();v.profiles(f(h.apnConfigs)),e("#profile").val(a).trigger("change")}r()}else errorOverlay()},function(e){errorOverlay()})}function u(n){var r=e.isFunction(n);r||showLoading();var o=d();if(o<a.defaultApnSize)return void errorOverlay();var t=!1;a.IPV4V6_SUPPORT&&"IPv4v6"==v.selectedPdpType()&&(t=!0),s.addOrEditApn({profileName:v.profileName(),pdpType:v.selectedPdpType(),index:o,wanApn:v.apn(),authMode:v.selectedAuthentication(),username:v.username(),password:v.password(),dnsMode:a.SHOW_APN_DNS?v.dnsMode():"auto",dns1:a.SHOW_APN_DNS?v.dns1():"",dns2:a.SHOW_APN_DNS?v.dns2():"",wanApnV6:t?v.apn():v.apnV6(),authModeV6:t?v.selectedAuthentication():v.selectedAuthenticationV6(),usernameV6:t?v.username():v.usernameV6(),passwordV6:t?v.password():v.passwordV6(),dnsModeV6:a.SHOW_APN_DNS?t?v.dnsMode():v.dnsModeV6():"auto",dns1V6:a.SHOW_APN_DNS?t?v.dns1():v.dns1V6():"",dns2V6:a.SHOW_APN_DNS?t?v.dns2():v.dns2V6():""},function(a){if(a.result){if(h=p(),v.profileName()!=v.selectedProfile()){var s=v.profileName();v.profiles(f(h.apnConfigs)),e("#profile").val(s).trigger("change")}r?n():(V(!1),successOverlay())}else errorOverlay()},function(e){errorOverlay()})}function _(){for(var n=e("#profile").find("option"),a=0;a<n.length&&n[a].value!=v.profileName();a++);return a}var v=this,h=p();h.apnNumPreset&&(a.maxApnNumber=h.apnNumPreset),v.showApnDns=n.observable(a.SHOW_APN_DNS),v.index=n.observable(h.currIndex),v.supportIPv6=n.observable(a.IPV6_SUPPORT),v.supportIpv4AndIpv6=n.observable(a.IPV4_AND_V6_SUPPORT),v.isCPE=n.observable(-1!=a.DEVICE.indexOf("cpe")),v.defApn=n.observable(h.profileName),v.apnMode=n.observable(h.apnMode),v.autoProfiles=n.observableArray(f(h.autoApnConfigs)),v.profiles=n.observableArray(f(h.apnConfigs)),v.pdpTypes=n.observableArray(t()),v.selectedPdpType=n.observable(h.pdpType),v.profileName=n.observable(h.profileName),v.apn=n.observable(h.wanApn),v.dnsMode=n.observable("manual"==h.dnsMode?"manual":"auto"),v.dns1=n.observable(h.dns1),v.dns2=n.observable(h.dns2),v.authModes=n.observableArray(o()),v.username=n.observable(h.username),v.password=n.observable(h.password),v.apnV6=n.observable(h.wanApnV6),v.dnsModeV6=n.observable("manual"==h.dnsModeV6?"manual":"auto"),v.dns1V6=n.observable(h.dns1V6),v.dns2V6=n.observable(h.dns2V6),v.authModesV6=n.observableArray(o()),v.usernameV6=n.observable(h.usernameV6),v.passwordV6=n.observable(h.passwordV6),v.pdpTypeNote=n.observable(!0),v.selectedProfile=n.observable(h.profileName),h.autoApnConfigs&&h.autoApnConfigs.length>0?v.selectedAutoProfile=n.observable(h.autoApnConfigs[0].profileName):v.selectedAutoProfile=n.observable(),a.EMPTY_APN_SUPPORT?(e("#apn_ipv4_apn").removeClass("required"),e("#apn_ipv6_apn").removeClass("required")):(e("#apn_ipv4_apn").addClass("required"),e("#apn_ipv6_apn").addClass("required")),v.selectedAuthentication=n.observable(h.authMode),v.selectedAuthenticationV6=n.observable(h.authModeV6),v.disableProfile=n.observable(!1),v.addApnHide=n.observable(!0),v.defaultCfg=n.observable(!0),v.isEqualDefCfg=n.observable(!0),v.transApn=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_ipv4_apn":"apn"),v.transDnsMode=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_dns_mode_ipv4":"apn_dns_mode"),v.transDns1=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_dns1_ipv4":"apn_dns1"),v.transDns2=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_dns2_ipv4":"apn_dns2"),v.transAuth=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_authentication_ipv4":"apn_authentication"),v.transUserName=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_user_name_ipv4":"apn_user_name"),v.transPassword=n.observable(a.IPV4_AND_V6_SUPPORT?"apn_password_ipv4":"apn_password"),v.transApnV6=n.observable("apn"),v.transDnsModeV6=n.observable("apn_dns_mode"),v.transDns1V6=n.observable("apn_dns1"),v.transDns2V6=n.observable("apn_dns2"),v.transAuthV6=n.observable("apn_authentication"),v.transUserNameV6=n.observable("apn_user_name"),v.transPasswordV6=n.observable("apn_password"),v.setDefaultVisible=n.observable(!c()),v.tmp1=n.computed(function(){"IP"==v.selectedPdpType()||"IPv4"==v.selectedPdpType()?(v.transApn("apn"),v.transDnsMode("apn_dns_mode"),v.transDns1("apn_dns1"),v.transDns2("apn_dns2"),v.transAuth("apn_authentication"),v.transUserName("apn_user_name"),v.transPassword("apn_password")):"IPv6"==v.selectedPdpType()?(v.transApnV6("apn"),v.transDnsModeV6("apn_dns_mode"),v.transDns1V6("apn_dns1"),v.transDns2V6("apn_dns2"),v.transAuthV6("apn_authentication"),v.transUserNameV6("apn_user_name"),v.transPasswordV6("apn_password")):a.IPV4_AND_V6_SUPPORT&&"IPv4v6"==v.selectedPdpType()?(v.transApn("apn_ipv4_apn"),v.transDnsMode("apn_dns_mode_ipv4"),v.transDns1("apn_dns1_ipv4"),v.transDns2("apn_dns2_ipv4"),v.transAuth("apn_authentication_ipv4"),v.transUserName("apn_user_name_ipv4"),v.transPassword("apn_password_ipv4"),v.transApnV6("apn_ipv6_apn"),v.transDnsModeV6("apn_dns_mode_ipv6"),v.transDns1V6("apn_dns1_ipv6"),v.transDns2V6("apn_dns2_ipv6"),v.transAuthV6("apn_authentication_ipv6"),v.transUserNameV6("apn_user_name_ipv6"),v.transPasswordV6("apn_password_ipv6")):(v.transApn("apn"),v.transDnsMode("apn_dns_mode"),v.transDns1("apn_dns1"),v.transDns2("apn_dns2"),v.transAuth("apn_authentication"),v.transUserName("apn_user_name"),v.transPassword("apn_password")),e("#apn_setting_form").translate()}),v.hasCapacity=n.computed(function(){return!(v.profiles().length>=a.maxApnNumber)}),v.autoApnChecked=n.computed(function(){return"auto"==v.apnMode()}),v.showDns=n.computed(function(){return"manual"==v.dnsMode()}),v.showDnsV6=n.computed(function(){return"manual"==v.dnsModeV6()}),v.checkInputDisable=n.computed(function(){return!("auto"!=v.apnMode()&&("auto"==v.apnMode()||!v.defaultCfg()||v.isEqualDefCfg()||v.disableProfile()))||("auto"==v.apnMode()||v.disableProfile()&&v.defaultCfg(),!1)});var b=s.getDeviceInfo();v.pdpTypeChangeAlert=function(){v.pdpTypeNote()&&!v.isCPE()&&showAlert({msg:"apn_pdptype_change_note",params:[b.lanDomain,b.ipAddress]})},v.showAutoApnDetail=n.computed(function(){return"auto"!=v.apnMode()||v.autoProfiles().length>0}),v.profileChangeHandler=function(e,n){if(v.pdpTypeNote(!0),"manual"!=v.apnMode())return!0;var a=v.getSelectedManualProfile();return v.setUIData(a),v.checkDefaultProfileStatus(),!0},v.autoProfileChangeHandler=function(e,n){if("auto"!=v.apnMode())return!0;var a=A[v.selectedAutoProfile()];return v.setUIData(a),v.checkDefaultProfileStatus(),!0},v.setUIData=function(e){clearValidateMsg("#apn_setting_form"),e&&(v.profileName(e.profileName),v.apn(e.wanApn),v.dnsMode("manual"!=e.dnsMode?"auto":"manual"),v.dns1(e.dns1),v.dns2(e.dns2),v.username(e.username),v.password(e.password),v.selectedAuthentication(e.authMode||"none"),v.apnV6(e.wanApnV6),v.dnsModeV6("manual"!=e.dnsModeV6?"auto":"manual"),v.dns1V6(e.dns1V6),v.dns2V6(e.dns2V6),v.usernameV6(e.usernameV6),v.passwordV6(e.passwordV6),v.selectedAuthenticationV6(e.authModeV6||"none"),v.selectedPdpType(e.pdpType))},v.checkDefaultProfileStatus=function(){var e=_();e<a.defaultApnSize||v.selectedProfile()==v.defApn()?v.defaultCfg(!0):v.defaultCfg(!1),e<a.defaultApnSize?v.isEqualDefCfg(!1):v.isEqualDefCfg(!0)},v.apnModeChangeHandler=function(e,n){return"auto"==v.apnMode()?v.showAutoApnDetail()&&v.autoProfileChangeHandler():v.profileChangeHandler(),!0},v.setDefaultAct=function(){if(!e("#apn_setting_form").valid())return!1;if(!v.selectedProfile())return!1;var n=s.getConnectionInfo().connectStatus;if(checkConnectedStatus(n))return showAlert({msg:"apn_cant_modify_status",params:[e.i18n.prop("connected").toLowerCase()]}),!1;if("auto"!=v.apnMode()&&v.isEqualDefCfg())if(e("#apn_setting_form").valid()){var a=!1;if(e.each(v.profiles(),function(e,n){n.value==v.profileName()&&(a=!0)}),a&&v.selectedProfile()!=v.profileName())return showInfo("apn_save_profile_exist"),!1;showLoading(),u(function(){r()})}else e(".error:first","#apn_setting_form").focus();else showLoading(),r()},v.getSelectedManualProfile=function(){var n={},a=e("#profile").val();void 0===v.selectedProfile()&&v.selectedProfile(a);var s=P[a],r=m[a];return s&&r?s.pdpType?(e.extend(n,r),e.extend(n,s)):(e.extend(n,s),e.extend(n,r)):s&&!r&&e.extend(n,s),n},v.saveAct=function(){var n=!1;if(e.each(v.profiles(),function(e,a){a.value==v.profileName()&&(n=!0)}),1==v.disableProfile()){if(e("#profile option").length>=a.maxApnNumber)return showInfo({msg:"apn_profile_full",params:[a.maxApnNumber]}),!1;if(n)return showInfo("apn_save_profile_exist"),!1;if(!e("#apn_setting_form").valid())return;var r=s.getStatusInfo();checkConnectedStatus(r.connectStatus)?showConfirm("disconnected_network_confirm",function(){showLoading("disconnecting"),s.disconnect({},function(e){e.result?l():errorOverlay()})}):l()}else{if(n&&v.selectedProfile()!=v.profileName())return showInfo("apn_save_profile_exist"),!1;u()}};var N={};v.addAct=function(){clearValidateMsg("#apn_setting_form"),v.pdpTypeNote(!0),v.disableProfile(!0),v.addApnHide(!0),N={profileName:v.profileName(),selectedPdpType:v.selectedPdpType(),wanApn:v.apn(),dnsMode:a.SHOW_APN_DNS?v.dnsMode():"auto",dns1:a.SHOW_APN_DNS?v.dns1():"",dns2:a.SHOW_APN_DNS?v.dns2():"",authMode:v.selectedAuthentication(),username:v.username(),password:v.password(),wanApnV6:v.apnV6(),dnsModeV6:a.SHOW_APN_DNS?v.dnsModeV6():"auto",dns1V6:a.SHOW_APN_DNS?v.dns1V6():"",dns2V6:a.SHOW_APN_DNS?v.dns2V6():"",authModeV6:v.selectedAuthenticationV6(),usernameV6:v.usernameV6(),passwordV6:v.passwordV6()},v.profileName(""),v.selectedPdpType("IP"),v.apn(""),v.dnsMode("auto"),v.dns1(""),v.dns2(""),v.selectedAuthentication("none"),v.username(""),v.password(""),v.apnV6(""),v.dnsModeV6("auto"),v.dns1V6(""),v.dns2V6(""),v.selectedAuthenticationV6("none"),v.usernameV6(""),v.passwordV6("")},v.cancelAddAct=function(){clearValidateMsg("#apn_setting_form"),v.pdpTypeNote(!1),v.disableProfile(!1),v.addApnHide(!1),v.profileName(N.profileName),v.selectedPdpType(N.selectedPdpType),v.apn(N.wanApn),v.dnsMode(N.dnsMode),v.dns1(N.dns1),v.dns2(N.dns2),v.selectedAuthentication(N.authMode),v.username(N.username),v.password(N.password),v.apnV6(N.wanApnV6),v.dnsModeV6(N.dnsModeV6),v.dns1V6(N.dns1V6),v.dns2V6(N.dns2V6),v.selectedAuthenticationV6(N.authModeV6),v.usernameV6(N.usernameV6),v.passwordV6(N.passwordV6)},v.deleteAct=function(){return _()<a.defaultApnSize?(errorOverlay("apn_delete_cant_delete_default"),!1):p().profileName==v.profileName()?(errorOverlay("apn_cant_delete_current"),!1):void showConfirm("apn_delete_confirm",function(){showLoading("deleting"),s.deleteApn({index:d()},function(e){e.result?(v.profiles(f(p().apnConfigs)),v.selectedProfile(v.defApn()),v.profileChangeHandler(),successOverlay()):errorOverlay()},function(e){errorOverlay()})})}}function c(){var e=s.getConnectionInfo();return checkConnectedStatus(e.connectStatus)}function v(){P={},m={},A={}}function V(a){v();var s=e("#container");n.cleanNode(s[0]);var r=new _;n.applyBindings(r,s[0]),r.checkDefaultProfileStatus(),a||addInterval(function(){r.setDefaultVisible(!c())},1e3),e("input").keypress(function(e){if(13==(e.keyCode?e.keyCode:e.which?e.which:e.charCode))return!1}),e("#apn_setting_form").validate({submitHandler:function(){r.saveAct()},rules:{profile_name:"apn_profile_name_check",apn_ipv4_apn:"apn_check",apn_dns1_ipv4:"ipv4",apn_dns2_ipv4:"ipv4",apn_ipv6_apn:"apn_check",apn_dns1_ipv6:"ipv6",apn_dns2_ipv6:"ipv6",apn_user_name_ipv4:"ppp_username_check",apn_password_ipv4:"ppp_password_check",apn_user_name_ipv6:"ppp_username_check",apn_password_ipv6:"ppp_password_check"}})}var P={},m={},A={};return{init:V}});
//# sourceMappingURL=../../sourcemaps/network/apn_setting.js.map
