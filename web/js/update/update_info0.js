define(["jquery","service","knockout","config/config"],function(n,e,i,r){function t(){var r=this;r.updateInfo=i.observable(),r.updateNoInfo=i.observable(),r.currentVersion=i.observable(),r.newVersion=i.observable(),r.updateLog=i.observable(),r.linkString=i.observable(),r.isSkipedWarning=i.observable(0);var t=function(n){if(0==n.length)return n;var e="http://",i=n.split("@");if(1==i.length)return n;e+=i[1].split("/")[0].split(":")[0]+"/",e+=i[0].split("//")[1].split(":")[0]+"/";for(var r=i[1].split("/"),t=1;t<r.length;t++)t==r.length-1?e+=r[t]:e+=r[t]+"/";return e};setUpdateInfoWarning=function(){showLoading();var n=r.isSkipedWarning(),i={};i.upgrade_notice_flag=n,e.setUpdateInfoWarning(i,function(n){hideLoading(),n?successOverlay():errorOverlay(),d()})},setIsSkipedWarning=function(){var e=n("#isSkipedWarning:checked");e&&0==e.length?r.isSkipedWarning(1):r.isSkipedWarning(0)};var a=function(n){if(n.length>0){if(-1==n.indexOf("\\n\\r"))return n;for(var e=["<p>","</p><p>","</p>"],i="",r=0,t=-1;;){if(-1==(t=n.indexOf("\\n\\r"))){i+=1==r?e[0]:e[1],i+=n,i+=e[2];break}0!=r&&(i+=1==r?e[0]:e[1],i+=n.substr(0,t),r++,n=n.substr(t+4))}return i}return""},g=function(){if(o==f)r.updateInfo(0);else{r.updateInfo(1),r.currentVersion(o),r.newVersion(f),r.updateLog(s);for(var n="",e=0;e<p.length;e++){if(0==e&&(n+="<p>"),n+="<a target='_blank' href=\"",n+=t(u[e]),n+='" >',n+=p[e],""==p[e]){n+="</a></p>";break}n+="</a></p><p>"}r.linkString(n)}},d=function(){var n=e.getUpdateInfoWarning();n.upgrade_notice_flag&&r.isSkipedWarning(2==n.upgrade_notice_flag?1:n.upgrade_notice_flag)};!function(){n.ajax({url:c,dataType:"xml",success:function(i){n(i).find("PackageDescription").each(function(e,i){s=a(n(i).find("Log").text()),f=n(i).find("FirmwareVersion").text()}),n(i).find("UpdateFile").each(function(e,i){var r=n(i);p[e]=r.text(),u[e]=r.attr("URL")}),o=e.getDeviceInfo().fw_version,g()},error:function(){r.updateInfo(0)}})}(),d()}function a(){var e=n("#container")[0];i.cleanNode(e);var r=new t;i.applyBindings(r,e)}var o="",f="",s="",p=[],u=[],c="description.xml";return{init:a}});
//# sourceMappingURL=../../sourcemaps/update/update_info0.js.map
