define(["jquery","service","knockout","config/config","status/statusBar"],function(e,a,t,n,o){function r(){var r=this;r.wanMode=n.opms_wan_mode;var i=a.getOTAUpdateSetting();r.isDataCard=-1!=n.DEVICE.toLowerCase().indexOf("datacard"),r.updateMode=t.observable(i.updateMode),r.updateIntervalDay=t.observable(i.updateIntervalDay),r.allowRoamingUpdate=t.observable(i.allowRoamingUpdate),r.lastCheckTime=t.observable(""),a.getOTASuccessTime({},function(e){r.lastCheckTime(e.dm_update_successful_time)}),r.clickAllowRoamingUpdate=function(){var a=e("#chkUpdateRoamPermission:checked");a&&0==a.length?r.allowRoamingUpdate("1"):r.allowRoamingUpdate("0")},r.apply=function(){var e={updateMode:r.updateMode(),updateIntervalDay:r.updateIntervalDay(),allowRoamingUpdate:r.allowRoamingUpdate()};showLoading(),a.setOTAUpdateSetting(e,function(e){e&&"success"==e.result?(i.allowRoamingUpdate=r.allowRoamingUpdate(),successOverlay()):errorOverlay()})},r.checkNewVersion=function(){function t(){function e(){var t=a.getNewVersionState(),n=a.getCurrentUpgradeState();t.hasNewVersion?o.showOTAAlert():"0"==t.new_version_state||"version_no_new_software"==t.new_version_state?showAlert("ota_no_new_version"):"version_processing"==t.new_version_state||"in_session"==t.new_version_state?showAlert("ota_update_running"):"version_checking_failed"==t.new_version_state||"network_unavailable"==t.new_version_state?errorOverlay("ota_check_fail"):"low_battery"==n.current_upgrade_state?showInfo("ota_low_battery"):"upgrade_pack_error"==n.current_upgrade_state?showInfo("ota_md5_error"):addTimeout(e,1e3)}"1"!=c.dm_update_package_file_exist&&showLoading("ota_new_version_checking"),a.setUpgradeSelectOp({selectOp:"check"},function(a){"success"==a.result?e():errorOverlay()})}var r=a.getNewVersionState();if(r.hasNewVersion)return void o.showOTAAlert();if("FOTA"==n.UPGRADE_TYPE){var i=["version_no_new_software","version_has_new_critical_software","version_has_new_optional_software","version_start","version_processing","version_roaming","version_checking","version_checking_failed"];if(-1!=e.inArray(r.new_version_state,i))return void showAlert("ota_update_running")}var s=a.getStatusInfo();if("upgrade_prepare_install"==s.current_upgrade_state)return void showInfo("ota_download_success");if("low_battery"==s.current_upgrade_state)return void showInfo("ota_low_battery");var _=["upgrade_pack_redownload","connecting_server","connect_server_success","upgrading","accept"];if(-1!=e.inArray(s.current_upgrade_state,_))return void o.showOTAAlert();var c=a.dmUpdatePackageExit();if("1"==c.dm_update_package_file_exist)return showInfo("ota_download_success"),void t();s.roamingStatus?showConfirm("ota_check_roaming_confirm",function(){t()}):t()},r.fixPageEnable=function(){var t=a.getStatusInfo();"connect"==t.connectWifiStatus||checkConnectedStatus(t.connectStatus)?enableBtn(e("#btnCheckNewVersion")):disableBtn(e("#btnCheckNewVersion"))}}function i(){var a=e("#container")[0];t.cleanNode(a);var n=new r;t.applyBindings(n,a),n.fixPageEnable(),addInterval(function(){n.fixPageEnable()},1e3),e("#frmOTAUpdate").validate({submitHandler:function(){n.apply()}})}return{init:i}});
//# sourceMappingURL=../../sourcemaps/update/ota_update.js.map
